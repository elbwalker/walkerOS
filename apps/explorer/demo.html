<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>walkerOS Explorer</title>
    <style>
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        margin: 0;
        padding: 20px;
        background: #f5f5f5;
      }
      .demo-container {
        max-width: 1200px;
        margin: 0 auto;
      }
      .demo-section {
        background: white;
        border-radius: 8px;
        padding: 24px;
        margin-bottom: 24px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      .demo-section h2 {
        margin-top: 0;
        color: #2563eb;
      }
      .demo-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 16px;
      }
      .integration-grid {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 16px;
        margin-top: 16px;
      }
      @media (max-width: 1024px) {
        .integration-grid {
          grid-template-columns: 1fr;
          gap: 16px;
        }
        .integration-html {
          order: -1;
        }
      }
      .component-demo {
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        padding: 16px;
        background: #fafafa;
      }
      .component-demo h3 {
        margin-top: 0;
        font-size: 16px;
        color: #374151;
      }
      .demo-item {
        margin-bottom: 16px;
      }
      .demo-item:last-child {
        margin-bottom: 0;
      }
      #status {
        background: #10b981;
        color: white;
        padding: 12px;
        border-radius: 6px;
        margin-bottom: 24px;
        font-weight: 500;
      }
      .controls {
        display: flex;
        gap: 12px;
        margin-top: 16px;
        flex-wrap: wrap;
      }
      .btn {
        padding: 8px 16px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        background: white;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s;
      }
      .btn:hover {
        background: #f3f4f6;
        border-color: #9ca3af;
      }
      .btn-primary {
        background: #3b82f6;
        color: white;
        border-color: #3b82f6;
      }
      .btn-primary:hover {
        background: #2563eb;
      }
    </style>
  </head>
  <body>
    <div class="demo-container">
      <h1>🚀 walkerOS Explorer - Phase 1 Components</h1>
      <div id="status">✅ All components loaded successfully!</div>

      <!-- CodeEditor Demo -->
      <div class="demo-section">
        <h2>1. CodeEditor Component</h2>
        <p>
          Advanced code editor with syntax highlighting, copy/format
          functionality, and Shadow DOM isolation.
        </p>
        <div class="demo-grid">
          <div class="component-demo">
            <h3>JavaScript Editor</h3>
            <div id="js-editor" style="height: 200px"></div>
            <div class="controls">
              <button class="btn" onclick="setJSCode()">Set Sample Code</button>
              <button class="btn" onclick="getJSCode()">Get Value</button>
            </div>
          </div>
          <div class="component-demo">
            <h3>JSON Editor</h3>
            <div id="json-editor" style="height: 200px"></div>
            <div class="controls">
              <button class="btn" onclick="setJSONCode()">
                Set Sample JSON
              </button>
              <button class="btn" onclick="formatJSON()">Format JSON</button>
            </div>
          </div>
        </div>
      </div>

      <!-- HtmlPreview Demo -->
      <div class="demo-section">
        <h2>2. HtmlPreview Component</h2>
        <p>
          Safe HTML rendering with Shadow DOM isolation, element interaction,
          and walkerOS integration.
        </p>
        <div class="demo-grid">
          <div class="component-demo">
            <h3>Interactive Preview</h3>
            <div id="html-preview" style="height: 250px"></div>
            <div class="controls">
              <button class="btn" onclick="setBasicHTML()">Basic HTML</button>
              <button class="btn" onclick="setInteractiveHTML()">
                Interactive Elements
              </button>
              <button class="btn" onclick="setWalkerOSHTML()">
                walkerOS Tagging
              </button>
            </div>
          </div>
          <div class="component-demo">
            <h3>HTML Input</h3>
            <div id="html-input" style="height: 200px"></div>
            <div class="controls">
              <button class="btn btn-primary" onclick="updatePreview()">
                Update Preview
              </button>
              <button class="btn" onclick="clearHighlights()">
                Clear Highlights
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- ResultDisplay Demo -->
      <div class="demo-section">
        <h2>3. ResultDisplay Component</h2>
        <p>
          Smart JSON/object visualization with syntax highlighting, expandable
          view, and copy functionality.
        </p>
        <div class="demo-grid">
          <div class="component-demo">
            <h3>Simple Values</h3>
            <div id="simple-result" style="height: 200px"></div>
            <div class="controls">
              <button class="btn" onclick="showString()">String</button>
              <button class="btn" onclick="showNumber()">Number</button>
              <button class="btn" onclick="showBoolean()">Boolean</button>
              <button class="btn" onclick="showNull()">Null</button>
            </div>
          </div>
          <div class="component-demo">
            <h3>Complex Objects</h3>
            <div id="complex-result" style="height: 200px"></div>
            <div class="controls">
              <button class="btn" onclick="showObject()">Object</button>
              <button class="btn" onclick="showArray()">Array</button>
              <button class="btn" onclick="showError()">Error</button>
              <button class="btn" onclick="showLargeData()">Large Data</button>
            </div>
          </div>
        </div>
      </div>

      <!-- CodeBox Demo -->
      <div class="demo-section">
        <h2>4. CodeBox Component</h2>
        <p>
          Smart wrapper combining CodeEditor with labels, actions, and
          consistent styling.
        </p>
        <div class="demo-grid">
          <div class="component-demo">
            <h3>Configuration Editor</h3>
            <div id="config-codebox" style="height: 250px"></div>
            <div class="controls">
              <button class="btn" onclick="resetConfig()">Reset</button>
              <button class="btn" onclick="getConfig()">Get Config</button>
            </div>
          </div>
          <div class="component-demo">
            <h3>Event Data Editor</h3>
            <div id="event-codebox" style="height: 250px"></div>
            <div class="controls">
              <button class="btn" onclick="setEventData()">
                Set Sample Event
              </button>
              <button class="btn" onclick="validateEvent()">Validate</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Integration Demo -->
      <div class="demo-section">
        <h2>5. Component Integration</h2>
        <p>
          Demonstration of components working together in a realistic scenario.
        </p>
        <div class="integration-grid">
          <div class="component-demo integration-html">
            <h3>HTML Source</h3>
            <div id="integration-html" style="height: 160px"></div>
            <div class="controls">
              <button class="btn btn-primary" onclick="updateIntegration()">
                Update Preview
              </button>
            </div>
          </div>
          <div class="component-demo">
            <h3>Live Preview</h3>
            <div id="integration-preview" style="height: 160px"></div>
          </div>
          <div class="component-demo">
            <h3>Click Results</h3>
            <div id="integration-result" style="height: 160px"></div>
            <div class="controls">
              <button class="btn" onclick="clearResults()">
                Clear Results
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="./dist/explorer.js"></script>
    <script>
      // Global component instances
      let components = {};

      // Initialize all components
      document.addEventListener('DOMContentLoaded', function () {
        initializeComponents();
      });

      function initializeComponents() {
        try {
          // CodeEditor demos
          components.jsEditor = new WalkerOSExplorer.CodeBox(
            document.getElementById('js-editor'),
            {
              label: 'JavaScript',
              language: 'javascript',
              value: 'function hello(name) {\n  return `Hello, ${name}!`;\n}',
              showCopy: true,
              showFormat: true,
              theme: 'light',
            },
          );

          components.jsonEditor = new WalkerOSExplorer.CodeBox(
            document.getElementById('json-editor'),
            {
              label: 'JSON',
              language: 'json',
              value: '{\n  "name": "walkerOS",\n  "version": "1.0.0"\n}',
              showCopy: true,
              showFormat: true,
            },
          );

          // HtmlPreview demos
          components.htmlPreview = new WalkerOSExplorer.HtmlPreview(
            document.getElementById('html-preview'),
            {
              html: `<div style="padding: 20px; text-align: center;">
                        <h3>Click elements to interact!</h3>
                        <button style="margin: 5px; padding: 10px;">Button 1</button>
                        <button style="margin: 5px; padding: 10px;">Button 2</button>
                    </div>`,
              onElementClick: (element, event) => {
                components.htmlPreview.highlightElement(element);
                const result = {
                  tag: element.tagName,
                  text: element.textContent,
                  attributes: Array.from(element.attributes).reduce(
                    (acc, attr) => {
                      acc[attr.name] = attr.value;
                      return acc;
                    },
                    {},
                  ),
                  timestamp: new Date().toISOString(),
                };
                if (components.integrationResult) {
                  components.integrationResult.setValue(result);
                }
              },
            },
          );

          components.htmlInput = new WalkerOSExplorer.CodeBox(
            document.getElementById('html-input'),
            {
              label: 'HTML Input',
              language: 'html',
              value:
                '<div style="padding: 20px;">\n  <h3>Sample HTML</h3>\n  <button>Click me!</button>\n</div>',
              height: '150px',
              showCopy: true,
              showFormat: true,
            },
          );

          // ResultDisplay demos
          components.simpleResult = new WalkerOSExplorer.ResultDisplay(
            document.getElementById('simple-result'),
            {
              value: 'Hello, walkerOS Explorer!',
              theme: 'light',
            },
          );

          components.complexResult = new WalkerOSExplorer.ResultDisplay(
            document.getElementById('complex-result'),
            {
              value: {
                user: { id: 123, name: 'John Doe', active: true },
                events: ['click', 'view', 'purchase'],
                metadata: { version: '1.0', timestamp: Date.now() },
              },
              expandable: true,
            },
          );

          // CodeBox demos
          components.configCodeBox = new WalkerOSExplorer.CodeBox(
            document.getElementById('config-codebox'),
            {
              label: 'walkerOS Configuration',
              value:
                '{\n  "tagging": 1,\n  "consent": {\n    "functional": true\n  }\n}',
              language: 'json',
              showCopy: true,
              showFormat: true,
              showReset: true,
              resetValue:
                '{\n  "tagging": 1,\n  "consent": {\n    "functional": true\n  }\n}',
            },
          );

          components.eventCodeBox = new WalkerOSExplorer.CodeBox(
            document.getElementById('event-codebox'),
            {
              label: 'Event Data',
              value:
                '{\n  "event": "page view",\n  "data": {\n    "title": "Home Page"\n  }\n}',
              language: 'json',
              showCopy: true,
              showFormat: true,
            },
          );

          // Integration demo
          const integrationHtmlValue = `<div data-elb="product" data-elb-id="123" style="padding: 20px; border: 1px solid #ccc; border-radius: 8px; margin: 10px; text-align: center;">
  <h3>Product Demo</h3>
  <p>Interactive walkerOS demo product</p>
  <button data-elbaction="add_to_cart" style="padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer;">Add to Cart</button>
  <button data-elbaction="view_details" style="padding: 10px 20px; background: #10b981; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px;">View Details</button>
</div>`;

          components.integrationHtml = new WalkerOSExplorer.CodeBox(
            document.getElementById('integration-html'),
            {
              label: 'HTML Source',
              value: integrationHtmlValue,
              height: '120px',
              showCopy: true,
              showFormat: true,
              showReset: true,
            },
          );

          components.integrationPreview = new WalkerOSExplorer.HtmlPreview(
            document.getElementById('integration-preview'),
            {
              html: components.integrationHtml.getValue(),
              previewId: 'integration-demo',
              onElementClick: (element, event) => {
                const data = {
                  element: element.tagName,
                  attributes: {},
                  walkerOS: {},
                  timestamp: new Date().toISOString(),
                };

                // Capture all attributes
                Array.from(element.attributes).forEach((attr) => {
                  data.attributes[attr.name] = attr.value;
                  if (attr.name.startsWith('data-elb')) {
                    data.walkerOS[attr.name] = attr.value;
                  }
                });

                components.integrationResult.setValue(data);
                components.integrationPreview.highlightElement(element);
              },
            },
          );

          components.integrationResult = new WalkerOSExplorer.ResultDisplay(
            document.getElementById('integration-result'),
            {
              value: {
                message:
                  'Click elements in the preview to see their data here!',
              },
              expandable: true,
            },
          );

          console.log('✅ All components initialized successfully!');
        } catch (error) {
          console.error('❌ Error initializing components:', error);
          document.getElementById('status').innerHTML =
            '❌ Error loading components: ' + error.message;
          document.getElementById('status').style.background = '#ef4444';
        }
      }

      // Demo functions
      function setJSCode() {
        components.jsEditor.setValue(
          '// walkerOS event handler\nfunction handleEvent(event) {\n  console.log("Event:", event.event);\n  console.log("Data:", event.data);\n  \n  // Process event data\n  const processed = {\n    timestamp: Date.now(),\n    type: event.event,\n    payload: event.data\n  };\n  \n  return processed;\n}',
        );
      }

      function getJSCode() {
        alert('JavaScript Code:\\n\\n' + components.jsEditor.getValue());
      }

      function setJSONCode() {
        components.jsonEditor.setValue(
          '{\n  "event": "product view",\n  "data": {\n    "id": "12345",\n    "name": "Demo Product",\n    "category": "Electronics",\n    "price": 99.99,\n    "currency": "USD"\n  },\n  "context": {\n    "page": "/products/demo",\n    "user": {\n      "id": "user-123",\n      "segment": "premium"\n    }\n  }\n}',
        );
      }

      function formatJSON() {
        try {
          const value = components.jsonEditor.getValue();
          const parsed = JSON.parse(value);
          const formatted = JSON.stringify(parsed, null, 2);
          components.jsonEditor.setValue(formatted);
        } catch (e) {
          alert('Invalid JSON: ' + e.message);
        }
      }

      function setBasicHTML() {
        components.htmlPreview.setHtml(
          '<div style="padding: 20px; background: #f0f9ff; border-radius: 8px;"><h2 style="color: #0369a1;">Basic HTML Demo</h2><p>This is a simple HTML preview with <strong>formatting</strong> and <em>styling</em>.</p><ul><li>List item 1</li><li>List item 2</li><li>List item 3</li></ul></div>',
        );
      }

      function setInteractiveHTML() {
        const html = `<div style="padding: 20px; background: #f0fdf4; border-radius: 8px;">
                <h2 style="color: #166534;">Interactive Elements</h2>
                <form style="margin: 15px 0;">
                    <input type="text" placeholder="Enter your name" style="padding: 8px; margin-right: 10px; border: 1px solid #ccc; border-radius: 4px;">
                    <button type="button" style="padding: 8px 16px; background: #16a34a; color: white; border: none; border-radius: 4px; cursor: pointer;">Say Hello</button>
                </form>
                <div style="margin-top: 15px;">
                    <button style="margin: 5px; padding: 10px 20px; background: #dc2626; color: white; border: none; border-radius: 4px; cursor: pointer;">Red Button</button>
                    <button style="margin: 5px; padding: 10px 20px; background: #2563eb; color: white; border: none; border-radius: 4px; cursor: pointer;">Blue Button</button>
                    <button style="margin: 5px; padding: 10px 20px; background: #7c3aed; color: white; border: none; border-radius: 4px; cursor: pointer;">Purple Button</button>
                </div>
            </div>`;
        components.htmlPreview.setHtml(html);
      }

      function setWalkerOSHTML() {
        const html = `<div data-elb="page" data-elb-page="demo" style="padding: 20px; background: #fefbf3; border-radius: 8px;">
                <h2 style="color: #92400e;">walkerOS Tagging Demo</h2>
                <div data-elb="product" data-elb-id="demo-product" style="border: 1px solid #fbbf24; padding: 15px; border-radius: 6px; margin: 15px 0; background: white;">
                    <h3>Demo Product</h3>
                    <p>Price: $99.99</p>
                    <button data-elbaction="add_to_cart" style="padding: 10px 20px; background: #f59e0b; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px;">Add to Cart</button>
                    <button data-elbaction="view_details" style="padding: 10px 20px; background: #92400e; color: white; border: none; border-radius: 4px; cursor: pointer;">View Details</button>
                </div>
                <div data-elb="navigation" style="margin-top: 20px;">
                    <a href="#" data-elbaction="navigate" data-elb-destination="home" style="margin-right: 15px; color: #92400e;">Home</a>
                    <a href="#" data-elbaction="navigate" data-elb-destination="products" style="margin-right: 15px; color: #92400e;">Products</a>
                    <a href="#" data-elbaction="navigate" data-elb-destination="about" style="color: #92400e;">About</a>
                </div>
            </div>`;
        components.htmlPreview.setHtml(html);
      }

      function updatePreview() {
        const html = components.htmlInput.getValue();
        components.htmlPreview.setHtml(html);
      }

      function clearHighlights() {
        components.htmlPreview.clearHighlights();
      }

      function showString() {
        components.simpleResult.setValue(
          'Hello, this is a string value with special characters: àáâãäå',
        );
      }

      function showNumber() {
        components.simpleResult.setValue(42.123456789);
      }

      function showBoolean() {
        components.simpleResult.setValue(true);
      }

      function showNull() {
        components.simpleResult.setValue(null);
      }

      function showObject() {
        components.complexResult.setValue({
          user: {
            id: 123,
            name: 'John Doe',
            email: 'john@example.com',
            preferences: {
              theme: 'dark',
              notifications: true,
              language: 'en',
            },
          },
          session: {
            id: 'sess-123',
            startTime: new Date().toISOString(),
            pages: ['/home', '/products', '/cart'],
          },
          metadata: {
            version: '1.0.0',
            build: '20240101',
            environment: 'production',
          },
        });
      }

      function showArray() {
        components.complexResult.setValue([
          { id: 1, name: 'Apple', category: 'Fruit', price: 1.5 },
          { id: 2, name: 'Banana', category: 'Fruit', price: 0.75 },
          { id: 3, name: 'Carrot', category: 'Vegetable', price: 2.0 },
          { id: 4, name: 'Broccoli', category: 'Vegetable', price: 3.5 },
          { id: 5, name: 'Bread', category: 'Bakery', price: 2.99 },
        ]);
      }

      function showError() {
        components.complexResult.setValue(
          new Error(
            'This is a sample error message to demonstrate error display',
          ),
        );
      }

      function showLargeData() {
        const largeData = {
          users: Array.from({ length: 50 }, (_, i) => ({
            id: i + 1,
            name: `User ${i + 1}`,
            email: `user${i + 1}@example.com`,
            active: Math.random() > 0.3,
          })),
          events: Array.from({ length: 100 }, (_, i) => ({
            id: i + 1,
            type: ['click', 'view', 'purchase'][Math.floor(Math.random() * 3)],
            timestamp: Date.now() - i * 1000 * 60,
            data: { page: `/page-${Math.floor(Math.random() * 10)}` },
          })),
        };
        components.complexResult.setValue(largeData);
      }

      function resetConfig() {
        components.configCodeBox.setValue(
          components.configCodeBox.options?.resetValue || '{}',
        );
      }

      function getConfig() {
        alert('Configuration:\\n\\n' + components.configCodeBox.getValue());
      }

      function setEventData() {
        components.eventCodeBox.setValue(
          '{\n  "event": "purchase complete",\n  "data": {\n    "order_id": "order-123",\n    "total": 299.99,\n    "currency": "USD",\n    "items": [\n      {\n        "id": "item-1",\n        "name": "Premium Widget",\n        "category": "Electronics",\n        "quantity": 2,\n        "price": 149.99\n      }\n    ]\n  },\n  "context": {\n    "page": "/checkout/success",\n    "user": {\n      "id": "user-456",\n      "email": "customer@example.com"\n    }\n  }\n}',
        );
      }

      function validateEvent() {
        try {
          const eventData = JSON.parse(components.eventCodeBox.getValue());
          if (eventData.event && eventData.data) {
            alert(
              '✅ Valid event structure!\\n\\nEvent: ' +
                eventData.event +
                '\\nData keys: ' +
                Object.keys(eventData.data).join(', '),
            );
          } else {
            alert('⚠️ Missing required fields: event and/or data');
          }
        } catch (e) {
          alert('❌ Invalid JSON: ' + e.message);
        }
      }

      function updateIntegration() {
        const html = components.integrationHtml.getValue();
        components.integrationPreview.setHtml(html);
      }

      function clearResults() {
        components.integrationResult.clear();
      }
    </script>
  </body>
</html>
