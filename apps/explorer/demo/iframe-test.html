<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Iframe Communication Test</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        padding: 2rem;
        background: #f5f5f5;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
      }
      .box {
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        overflow: hidden;
      }
      .header {
        background: #333;
        color: white;
        padding: 0.5rem 1rem;
        font-weight: 600;
      }
      .content {
        padding: 1rem;
      }
      iframe {
        width: 100%;
        height: 400px;
        border: none;
        background: white;
      }
      .events {
        height: 400px;
        overflow: auto;
        background: #1e1e1e;
        color: #d4d4d4;
        padding: 1rem;
        font-family: 'Monaco', 'Courier New', monospace;
        font-size: 14px;
        line-height: 1.6;
      }
      .event {
        margin-bottom: 1rem;
        padding: 0.5rem;
        background: #2d2d2d;
        border-left: 3px solid #4fc3f7;
        border-radius: 4px;
      }
      .event-type {
        color: #4fc3f7;
        font-weight: bold;
      }
      .event-data {
        color: #9cdcfe;
        margin-top: 0.25rem;
      }
      button {
        background: #4fc3f7;
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 600;
      }
      button:hover {
        background: #3ba3cc;
      }
    </style>
  </head>
  <body>
    <h1 style="margin-bottom: 1rem;">Iframe Communication Test</h1>
    <p style="margin-bottom: 2rem; color: #666;">
      Click the button in the iframe to send data to the parent window.
    </p>

    <div class="container">
      <!-- Preview Box -->
      <div class="box">
        <div class="header">Preview (Iframe)</div>
        <div class="content">
          <iframe id="preview" title="Preview"></iframe>
        </div>
      </div>

      <!-- Events Box -->
      <div class="box">
        <div class="header">Events (Parent Window)</div>
        <div class="content">
          <div id="events" class="events">
            <div style="color: #888;">Waiting for events...</div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Parent window: Listen for messages from iframe
      const eventsContainer = document.getElementById('events');
      let eventCount = 0;

      window.addEventListener('message', (event) => {
        // Security: In production, validate event.origin
        if (event.data?.type === 'demoEvent') {
          eventCount++;

          // Clear "waiting" message on first event
          if (eventCount === 1) {
            eventsContainer.innerHTML = '';
          }

          // Add event to display
          const eventEl = document.createElement('div');
          eventEl.className = 'event';
          eventEl.innerHTML = `
            <div class="event-type">Event #${eventCount}: ${event.data.type}</div>
            <div class="event-data">Title: "${event.data.title}"</div>
            <div class="event-data" style="color: #ce9178;">Timestamp: ${new Date(event.data.timestamp).toLocaleTimeString()}</div>
          `;

          eventsContainer.insertBefore(eventEl, eventsContainer.firstChild);
        }
      });

      // Setup iframe content
      const iframe = document.getElementById('preview');
      iframe.onload = () => {
        const doc = iframe.contentDocument;
        doc.open();
        doc.write(`
          <!DOCTYPE html>
          <html>
            <head>
              <meta charset="utf-8">
              <style>
                * { margin: 0; padding: 0; box-sizing: border-box; }
                body {
                  padding: 2rem;
                  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                }
                h1 {
                  color: #333;
                  margin-bottom: 1rem;
                }
                p {
                  color: #666;
                  margin-bottom: 1.5rem;
                  line-height: 1.6;
                }
                button {
                  background: #4fc3f7;
                  color: white;
                  border: none;
                  padding: 0.75rem 1.5rem;
                  border-radius: 6px;
                  cursor: pointer;
                  font-weight: 600;
                  font-size: 16px;
                  transition: background 0.2s;
                }
                button:hover {
                  background: #3ba3cc;
                  transform: translateY(-1px);
                }
                .info {
                  margin-top: 2rem;
                  padding: 1rem;
                  background: #f0f9ff;
                  border-left: 4px solid #4fc3f7;
                  border-radius: 4px;
                }
                .info strong {
                  color: #0369a1;
                }
              </style>
            </head>
            <body>
              <h1 id="title">Hello from Iframe!</h1>
              <p>This content is rendered inside an iframe. Click the button below to send the title text to the parent window.</p>

              <button onclick="sendToParent()">
                ðŸ“¤ Send Title to Parent
              </button>

              <div class="info">
                <strong>How it works:</strong><br>
                1. Button captures the innerText of the h1 element<br>
                2. Sends it to parent via postMessage<br>
                3. Parent receives and displays it in the Events box
              </div>

              <script>
                function sendToParent() {
                  const title = document.getElementById('title').innerText;

                  // Send message to parent window
                  window.parent.postMessage({
                    type: 'demoEvent',
                    title: title,
                    timestamp: Date.now()
                  }, '*');

                  // Visual feedback
                  const btn = event.target;
                  const originalText = btn.textContent;
                  btn.textContent = 'âœ“ Sent!';
                  btn.style.background = '#10b981';

                  setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '#4fc3f7';
                  }, 1000);
                }
              </script>
            </body>
          </html>
        `);
        doc.close();
      };

      // Trigger iframe load
      iframe.src = 'about:blank';
    </script>
  </body>
</html>
