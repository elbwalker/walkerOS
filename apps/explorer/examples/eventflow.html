<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EventFlow Example</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        button {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
        }
        button:hover {
            background: #f0f0f0;
        }
        .btn-primary {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        .btn-primary:hover {
            background: #0056b3;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            background: #e8f5e9;
            border: 1px solid #4caf50;
            color: #2e7d32;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ”„ EventFlow Example</h1>
        <p>Visualization of event flow from entities through destinations in real-time.</p>
        
        <div class="status" id="status">
            Ready to track events. Click buttons below to generate sample events.
        </div>
        
        <div id="eventflow" style="height: 400px; border: 1px solid #ddd; border-radius: 4px; margin: 20px 0;"></div>
        
        <div class="controls">
            <button onclick="addProductView()">Product View</button>
            <button onclick="addAddToCart()">Add to Cart</button>
            <button onclick="addPurchase()">Purchase</button>
            <button onclick="addCustomEvent()">Custom Event</button>
            <button class="btn-primary" onclick="simulateUserJourney()">Simulate Journey</button>
            <button onclick="clearFlow()">Clear Flow</button>
        </div>
    </div>

    <script src="../explorer.js"></script>
    <script>
        let eventflow = null;
        let eventCounter = 0;

        document.addEventListener('DOMContentLoaded', () => {
            eventflow = WalkerExplorer.createEventFlow('#eventflow', {
                height: '380px',
                showTimeline: true,
                showFilters: true,
                showMetrics: true,
                groupByEntity: true,
                autoScroll: true,
                maxEvents: 100,
                onEventCapture: (event) => {
                    updateStatus(`Event captured: ${event.event}`);
                },
                onEventSelect: (event) => {
                    console.log('Event selected:', event);
                },
                onExport: (events) => {
                    console.log('Events exported:', events.length);
                }
            });
            
            window.eventflow = eventflow;
            
            // Add initial welcome event
            eventflow.addEvent({
                id: 'welcome_' + Date.now(),
                event: 'demo_start',
                source: 'eventflow-demo',
                timestamp: Date.now(),
                data: {
                    page_title: 'EventFlow Demo',
                    demo_mode: true,
                    entity: 'page',
                    entity_id: 'demo-page'
                },
                context: {
                    destinations: ['ga4']
                }
            });
        });

        function updateStatus(message) {
            const status = document.getElementById('status');
            status.textContent = message;
            
            // Reset status after 3 seconds
            setTimeout(() => {
                status.textContent = 'Ready to track events. Click buttons below to generate sample events.';
            }, 3000);
        }

        window.addProductView = () => {
            eventCounter++;
            eventflow.addEvent({
                id: 'view_' + eventCounter,
                event: 'product_view',
                source: 'demo-interaction',
                timestamp: Date.now(),
                data: {
                    product_id: 'product-' + eventCounter,
                    product_name: 'Demo Product ' + eventCounter,
                    category: 'electronics',
                    price: 99.99 + (eventCounter * 10),
                    entity: 'product',
                    entity_id: 'product-' + eventCounter
                },
                context: {
                    destinations: ['ga4', 'meta']
                }
            });
        };

        window.addAddToCart = () => {
            eventCounter++;
            eventflow.addEvent({
                id: 'cart_' + eventCounter,
                event: 'add_to_cart',
                source: 'demo-interaction',
                timestamp: Date.now(),
                data: {
                    product_id: 'product-' + eventCounter,
                    quantity: Math.floor(Math.random() * 3) + 1,
                    value: (99.99 + (eventCounter * 10)) * (Math.floor(Math.random() * 3) + 1),
                    entity: 'product',
                    entity_id: 'product-' + eventCounter
                },
                context: {
                    destinations: ['ga4', 'meta', 'gtm']
                }
            });
        };

        window.addPurchase = () => {
            eventCounter++;
            eventflow.addEvent({
                id: 'purchase_' + eventCounter,
                event: 'purchase',
                source: 'demo-interaction',
                timestamp: Date.now(),
                data: {
                    transaction_id: 'txn_' + eventCounter + '_' + Date.now(),
                    value: 299.97,
                    currency: 'USD',
                    items: [
                        { product_id: 'product-1', quantity: 2 },
                        { product_id: 'product-2', quantity: 1 }
                    ],
                    entity: 'user',
                    entity_id: 'user-demo'
                },
                context: {
                    destinations: ['ga4', 'meta']
                }
            });
        };

        window.addCustomEvent = () => {
            eventCounter++;
            const customEvents = [
                { event: 'search', entity: 'page', data: { query: 'demo products', results: 12 } },
                { event: 'scroll', entity: 'page', data: { scroll_depth: 75, page_height: 1200 } },
                { event: 'click', entity: 'user', data: { element: 'cta-button', position: 'header' } },
                { event: 'video_play', entity: 'page', data: { video_id: 'demo-video', duration: 120 } }
            ];
            
            const randomEvent = customEvents[Math.floor(Math.random() * customEvents.length)];
            
            eventflow.addEvent({
                id: 'custom_' + eventCounter,
                event: randomEvent.event,
                source: 'demo-random',
                timestamp: Date.now(),
                data: {
                    ...randomEvent.data,
                    entity: randomEvent.entity,
                    entity_id: randomEvent.entity + '-demo'
                },
                context: {
                    destinations: ['gtm']
                }
            });
        };

        window.simulateUserJourney = () => {
            updateStatus('Simulating user journey...');
            
            const journeySteps = [
                { event: 'page_view', entity: 'page', delay: 0 },
                { event: 'product_view', entity: 'product', delay: 1000 },
                { event: 'product_view', entity: 'product', delay: 2000 },
                { event: 'add_to_cart', entity: 'product', delay: 3500 },
                { event: 'cart_view', entity: 'page', delay: 4500 },
                { event: 'checkout_start', entity: 'user', delay: 6000 },
                { event: 'purchase', entity: 'user', delay: 8000 }
            ];
            
            journeySteps.forEach((step, index) => {
                setTimeout(() => {
                    eventCounter++;
                    eventflow.addEvent({
                        id: 'journey_' + eventCounter,
                        event: step.event,
                        source: 'user-journey',
                        timestamp: Date.now(),
                        data: {
                            journey_step: index + 1,
                            session_id: 'session_demo_' + Date.now(),
                            user_id: 'user_demo',
                            entity: step.entity,
                            entity_id: step.entity + '-journey'
                        },
                        context: {
                            destinations: step.event === 'purchase' ? ['ga4', 'meta'] : ['ga4']
                        }
                    });
                    
                    if (index === journeySteps.length - 1) {
                        updateStatus('User journey simulation completed!');
                    }
                }, step.delay);
            });
        };

        window.clearFlow = () => {
            eventflow.clearEvents();
            eventCounter = 0;
            updateStatus('Event flow cleared');
        };
    </script>
</body>
</html>