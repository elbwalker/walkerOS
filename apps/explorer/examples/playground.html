<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WalkerOS Explorer - Event Flow Playground</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: #f9fafb;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    header {
      background: white;
      border-bottom: 1px solid #e5e7eb;
      padding: 16px 24px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    
    header h1 {
      font-size: 24px;
      color: #1f2937;
      margin-bottom: 4px;
    }
    
    header p {
      color: #6b7280;
      font-size: 14px;
    }
    
    main {
      flex: 1;
      padding: 24px;
      overflow: hidden;
    }
    
    #playground {
      height: 100%;
      background: white;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    
    .controls {
      padding: 16px 24px;
      background: #f3f4f6;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      gap: 12px;
      align-items: center;
    }
    
    button {
      padding: 8px 16px;
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: background 0.2s;
    }
    
    button:hover {
      background: #2563eb;
    }
    
    button:active {
      background: #1d4ed8;
    }
    
    button.secondary {
      background: #6b7280;
    }
    
    button.secondary:hover {
      background: #4b5563;
    }
    
    .status {
      margin-left: auto;
      padding: 4px 12px;
      background: #10b981;
      color: white;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .example-selector {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    
    select {
      padding: 6px 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      background: white;
      font-size: 14px;
      cursor: pointer;
    }
    
    .info {
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      border-radius: 6px;
      padding: 12px 16px;
      margin: 16px 24px;
      color: #1e40af;
      font-size: 14px;
    }
    
    .info strong {
      color: #1e3a8a;
    }
  </style>
  <script src="../dist/explorer.js"></script>
</head>
<body>
  <header>
    <h1>WalkerOS Event Flow Playground</h1>
    <p>Visualize the complete event tracking pipeline: HTML ‚Üí Preview ‚Üí Collector ‚Üí Mapping ‚Üí Destination</p>
  </header>
  
  <main>
    <div class="controls">
      <button id="executeBtn">Execute Pipeline</button>
      <button id="clearBtn" class="secondary">Clear Events</button>
      
      <div class="example-selector">
        <label for="exampleSelect">Load Example:</label>
        <select id="exampleSelect">
          <option value="ecommerce">E-commerce Product</option>
          <option value="form">Contact Form</option>
          <option value="navigation">Navigation Menu</option>
          <option value="custom">Custom Events</option>
        </select>
      </div>
      
      <div class="status">Ready</div>
    </div>
    
    <div class="info">
      <strong>Try it out:</strong> Edit the HTML on the left, click elements in the preview, modify the mapping rules, and see the final destination calls on the right!
    </div>
    
    <div id="playground"></div>
  </main>
  
  <script>
    // Wait for the explorer bundle to load
    document.addEventListener('DOMContentLoaded', () => {
      const { createPlayground } = WalkerExplorer;
      
      // Example configurations
      const examples = {
        ecommerce: {
          html: `<div data-elb="product" data-elbcontext="stage:listing" class="product-card">
  <img src="https://via.placeholder.com/200" alt="Product" class="product-image" />
  <h3 data-elb-product="name:#innerText" class="product-title">Awesome Product</h3>
  <p data-elb-product="category:electronics" class="product-category">Electronics</p>
  <p data-elb-product="price:299.99" class="product-price">$299.99</p>
  <div data-elb-product="rating:4.5" class="product-rating">
    ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 4.5/5
  </div>
  <div class="product-actions">
    <button 
      data-elbaction="click:view"
      data-elb-product="id:PROD-123"
      class="btn btn-secondary"
    >
      View Details
    </button>
    <button 
      data-elbaction="click:add"
      data-elb-product="quantity:1"
      class="btn btn-primary"
    >
      Add to Cart
    </button>
  </div>
</div>`,
          css: `.product-card {
  max-width: 300px;
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  padding: 20px;
  background: white;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.product-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.product-image {
  width: 100%;
  height: 200px;
  object-fit: cover;
  border-radius: 8px;
  margin-bottom: 16px;
}

.product-title {
  font-size: 1.5rem;
  font-weight: 600;
  color: #1f2937;
  margin: 0 0 8px 0;
}

.product-category {
  color: #6b7280;
  font-size: 0.875rem;
  margin: 0 0 12px 0;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.product-price {
  font-size: 1.25rem;
  font-weight: 700;
  color: #059669;
  margin: 0 0 8px 0;
}

.product-rating {
  color: #f59e0b;
  font-size: 0.875rem;
  margin: 0 0 20px 0;
}

.product-actions {
  display: flex;
  gap: 12px;
}

.btn {
  padding: 12px 20px;
  border: none;
  border-radius: 6px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
  flex: 1;
}

.btn-primary {
  background: #3b82f6;
  color: white;
}

.btn-primary:hover {
  background: #2563eb;
  transform: translateY(-1px);
}

.btn-secondary {
  background: #f3f4f6;
  color: #374151;
}

.btn-secondary:hover {
  background: #e5e7eb;
  transform: translateY(-1px);
}`,
          js: `// Enhanced product interactions
console.log('üõçÔ∏è E-commerce demo loaded');

// Add hover animations
const productCard = document.querySelector('.product-card');
if (productCard) {
  productCard.addEventListener('mouseenter', () => {
    console.log('üëÄ Customer viewing product');
  });
}

// Track button interactions
document.addEventListener('click', (e) => {
  if (e.target.matches('[data-elbaction]')) {
    const action = e.target.getAttribute('data-elbaction');
    const [, actionType] = action.split(':');
    
    console.log(\`üéØ Action triggered: \${actionType}\`);
    
    // Add visual feedback
    e.target.style.transform = 'scale(0.95)';
    setTimeout(() => {
      e.target.style.transform = '';
    }, 150);
    
    // Simulate cart animation for add action
    if (actionType === 'add') {
      showCartAnimation();
    }
  }
});

// Cart animation
function showCartAnimation() {
  const button = document.querySelector('[data-elbaction*="add"]');
  if (button) {
    const originalText = button.textContent;
    button.textContent = '‚úÖ Added!';
    button.style.background = '#10b981';
    
    setTimeout(() => {
      button.textContent = originalText;
      button.style.background = '#3b82f6';
    }, 2000);
  }
}

// Simulate dynamic pricing
setTimeout(() => {
  const priceElement = document.querySelector('.product-price');
  if (priceElement) {
    priceElement.style.color = '#dc2626';
    priceElement.innerHTML = '<s>$299.99</s> <span style="color: #059669;">$249.99 (Sale!)</span>';
    console.log('üí∞ Price updated - special offer!');
  }
}, 3000);`,
          mapping: {
            product: {
              view: {
                name: 'view_item',
                data: {
                  map: {
                    currency: { value: 'USD' },
                    value: 'data.price',
                    item_id: 'data.id',
                    item_name: 'data.name',
                    item_category: 'data.category',
                  }
                }
              },
              add: {
                name: 'add_to_cart',
                data: {
                  map: {
                    currency: { value: 'USD' },
                    value: 'data.price',
                    quantity: 'data.quantity',
                    items: [{
                      item_id: 'data.id',
                      item_name: 'data.name',
                      price: 'data.price',
                      quantity: 'data.quantity'
                    }]
                  }
                }
              }
            }
          }
        },
        
        form: {
          html: `<form data-elb="form" data-elb-form="name:contact">
  <h3>Contact Us</h3>
  <div>
    <label>Name:</label>
    <input 
      type="text" 
      data-elb-form="field:name"
      placeholder="Your name"
    />
  </div>
  <div>
    <label>Email:</label>
    <input 
      type="email" 
      data-elb-form="field:email"
      placeholder="your@email.com"
    />
  </div>
  <div>
    <label>Message:</label>
    <textarea 
      data-elb-form="field:message"
      placeholder="Your message"
    ></textarea>
  </div>
  <button 
    type="button"
    data-elbaction="click:submit"
    data-elb-form="type:contact"
  >
    Send Message
  </button>
</form>`,
          mapping: {
            form: {
              submit: {
                name: 'form_submit',
                data: {
                  map: {
                    form_name: 'data.name',
                    form_type: 'data.type',
                    form_destination: { value: 'support@example.com' }
                  }
                }
              }
            }
          }
        },
        
        navigation: {
          html: `<nav data-elb="navigation">
  <ul style="list-style: none; padding: 0;">
    <li>
      <a href="#" 
         data-elbaction="click:navigate"
         data-elb-navigation="page:home"
         data-elb-navigation="section:main"
      >Home</a>
    </li>
    <li>
      <a href="#" 
         data-elbaction="click:navigate"
         data-elb-navigation="page:products"
         data-elb-navigation="section:catalog"
      >Products</a>
    </li>
    <li>
      <a href="#" 
         data-elbaction="click:navigate"
         data-elb-navigation="page:about"
         data-elb-navigation="section:info"
      >About</a>
    </li>
    <li>
      <a href="#" 
         data-elbaction="click:navigate"
         data-elb-navigation="page:contact"
         data-elb-navigation="section:support"
      >Contact</a>
    </li>
  </ul>
</nav>`,
          mapping: {
            navigation: {
              navigate: {
                name: 'navigation_click',
                data: {
                  map: {
                    page_location: 'data.page',
                    link_text: 'data.page',
                    link_section: 'data.section'
                  }
                }
              }
            }
          }
        },
        
        custom: {
          html: `<div data-elb="custom">
  <h3>Custom Event Examples</h3>
  <button 
    data-elbaction="click:action1"
    data-elb-custom="value:100"
    data-elb-custom="type:premium"
  >
    Custom Action 1
  </button>
  <button 
    data-elbaction="click:action2"
    data-elb-custom="value:200"
    data-elb-custom="type:standard"
  >
    Custom Action 2
  </button>
  <div 
    data-elbaction="load:impression"
    data-elb-custom="position:hero"
    data-elb-custom="variant:A"
    style="padding: 20px; background: #fef3c7; margin-top: 10px;"
  >
    This element tracks impressions on load
  </div>
</div>`,
          mapping: {
            custom: {
              '*': {
                name: { 
                  fn: (event) => `custom_${event.action}`
                },
                data: {
                  map: {
                    event_category: 'entity',
                    event_action: 'action',
                    event_value: 'data.value',
                    custom_type: 'data.type'
                  }
                }
              }
            }
          }
        }
      };
      
      // Create playground instance
      const playground = createPlayground(
        document.getElementById('playground'),
        {
          height: 'calc(100% - 120px)',
          initialHTML: examples.ecommerce.html,
          initialCSS: examples.ecommerce.css,
          initialJS: examples.ecommerce.js,
          initialMapping: examples.ecommerce.mapping
        }
      );
      
      // Execute button
      document.getElementById('executeBtn').addEventListener('click', async () => {
        const status = document.querySelector('.status');
        status.textContent = 'Executing...';
        status.style.background = '#f59e0b';
        
        try {
          await playground.execute();
          status.textContent = 'Complete';
          status.style.background = '#10b981';
        } catch (error) {
          status.textContent = 'Error';
          status.style.background = '#ef4444';
          console.error('Execution error:', error);
        }
      });
      
      // Clear button
      document.getElementById('clearBtn').addEventListener('click', () => {
        const graph = playground.getGraph();
        const previewNode = graph.getNode('preview-1');
        if (previewNode && previewNode.clearEvents) {
          previewNode.clearEvents();
          playground.execute();
        }
      });
      
      // Example selector
      document.getElementById('exampleSelect').addEventListener('change', (e) => {
        const example = examples[e.target.value];
        if (example) {
          // Set all code content
          if (playground.setAllCode) {
            playground.setAllCode({
              html: example.html,
              css: example.css || '',
              js: example.js || ''
            });
          } else {
            // Fallback for basic setHTML
            playground.setHTML(example.html);
          }
          playground.setMapping(example.mapping);
        }
      });
      
      // Log for debugging
      console.log('Playground initialized:', playground);
      console.log('Graph API:', playground.getGraph());
    });
  </script>
</body>
</html>