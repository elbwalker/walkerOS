<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Walker.js - Batch Processing Example</title>
    <style>
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        max-width: 800px;
        margin: 40px auto;
        padding: 20px;
        line-height: 1.6;
      }
      .product-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin: 20px 0;
      }
      .product {
        border: 1px solid #ddd;
        padding: 20px;
        border-radius: 8px;
        min-height: 180px;
        background: white;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
      }
      .product.visible {
        border-color: #28a745;
        background: #f8fff8;
      }
      .spacer {
        height: 50vh;
        background: #f8f9fa;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        color: #666;
        margin: 20px 0;
      }
      .console {
        background: #f5f5f5;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 10px;
        margin-top: 20px;
        font-family: monospace;
        font-size: 14px;
        max-height: 400px;
        overflow-y: auto;
        position: fixed;
        top: 20px;
        right: 20px;
        width: 300px;
        z-index: 1000;
      }
      .console-entry {
        margin: 5px 0;
        padding: 5px;
        background: white;
        border-radius: 2px;
      }
      .batch-indicator {
        background: #007bff;
        color: white;
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 12px;
        margin: 2px 0;
      }
      .scroll-instruction {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 4px;
        padding: 15px;
        margin: 20px 0;
      }
    </style>
  </head>
  <body>
    <div class="scroll-instruction">
      <strong>üîç Batch Processing Demo</strong><br />
      Products are displayed in a grid. Scroll quickly to trigger multiple
      visibility events. Events are batched every 2000ms. Watch the console on
      the right!
    </div>

    <h1>Walker.js - Batch Processing with Visible Triggers</h1>

    <p>
      This example demonstrates batch processing of visibility events with a
      2000ms interval.
    </p>

    <!-- Global properties -->
    <div data-elbglobals="site:batch-demo;feature:visibility-batching"></div>

    <!-- Context for this section -->
    <div data-elbcontext="section:product-catalog;batch:enabled">
      <div class="product-grid">
        <div
          class="product"
          data-elb="product"
          data-elb-product="id:101;name:Smart Phone;price:899.99;category:electronics"
          data-elbaction="visible:view"
        >
          <h3>üì± Smart Phone</h3>
          <p>Latest smartphone with advanced features</p>
          <p><strong>Price: $899.99</strong></p>
        </div>

        <div
          class="product"
          data-elb="product"
          data-elb-product="id:102;name:Laptop Pro;price:1599.99;category:electronics"
          data-elbaction="visible:view"
        >
          <h3>üíª Laptop Pro</h3>
          <p>High-performance laptop for professionals</p>
          <p><strong>Price: $1,599.99</strong></p>
        </div>

        <div
          class="product"
          data-elb="product"
          data-elb-product="id:103;name:Wireless Headphones;price:299.99;category:audio"
          data-elbaction="visible:view"
        >
          <h3>üéß Wireless Headphones</h3>
          <p>Premium noise-cancelling headphones</p>
          <p><strong>Price: $299.99</strong></p>
        </div>
      </div>

      <div class="spacer">Scroll down for more products...</div>

      <div class="product-grid">
        <div
          class="product"
          data-elb="product"
          data-elb-product="id:104;name:Smart Watch;price:449.99;category:wearables"
          data-elbaction="visible:view"
        >
          <h3>‚åö Smart Watch</h3>
          <p>Advanced fitness tracking and notifications</p>
          <p><strong>Price: $449.99</strong></p>
        </div>

        <div
          class="product"
          data-elb="product"
          data-elb-product="id:105;name:Tablet Pro;price:799.99;category:electronics"
          data-elbaction="visible:view"
        >
          <h3>üì± Tablet Pro</h3>
          <p>Professional tablet with stylus support</p>
          <p><strong>Price: $799.99</strong></p>
        </div>

        <div
          class="product"
          data-elb="product"
          data-elb-product="id:106;name:Gaming Mouse;price:89.99;category:accessories"
          data-elbaction="visible:view"
        >
          <h3>üñ±Ô∏è Gaming Mouse</h3>
          <p>High-precision gaming mouse with RGB</p>
          <p><strong>Price: $89.99</strong></p>
        </div>
      </div>

      <div class="spacer">Keep scrolling...</div>

      <div class="product-grid">
        <div
          class="product"
          data-elb="product"
          data-elb-product="id:107;name:Bluetooth Speaker;price:149.99;category:audio"
          data-elbaction="visible:view"
        >
          <h3>üîä Bluetooth Speaker</h3>
          <p>Portable wireless speaker with deep bass</p>
          <p><strong>Price: $149.99</strong></p>
        </div>

        <div
          class="product"
          data-elb="product"
          data-elb-product="id:108;name:Webcam HD;price:79.99;category:accessories"
          data-elbaction="visible:view"
        >
          <h3>üìπ Webcam HD</h3>
          <p>1080p webcam for streaming and calls</p>
          <p><strong>Price: $79.99</strong></p>
        </div>

        <div
          class="product"
          data-elb="product"
          data-elb-product="id:109;name:Mechanical Keyboard;price:159.99;category:accessories"
          data-elbaction="visible:view"
        >
          <h3>‚å®Ô∏è Mechanical Keyboard</h3>
          <p>RGB mechanical keyboard with cherry switches</p>
          <p><strong>Price: $159.99</strong></p>
        </div>
      </div>

      <div class="spacer">
        End of products - check the console for batched events!
      </div>
    </div>

    <!-- Event console -->
    <div class="console">
      <h3>Batch Events Console</h3>
      <div id="console-output"></div>
    </div>

    <!-- Include walker.js -->
    <script src="../dist/walker.js"></script>

    <script>
      // Initialize walker.js with batch processing configuration
      Walkerjs.default({
        elb: 'elb',
        instance: 'walkerjs',
        collector: {
          destinations: {
            // Simple console destination with both push and pushBatch
            console: {
              type: 'console',
              push: (event) => {
                console.log('üöÄ ~ event:', event);
                const output = document.getElementById('console-output');
                const entry = document.createElement('div');
                entry.className = 'console-entry';
                entry.innerHTML = `
                <strong>üì§ ${event.event}</strong><br>
                Data: ${JSON.stringify(event.data)}<br>
                Context: ${JSON.stringify(event.context)}
              `;
                output.insertBefore(entry, output.firstChild);
                console.log('üì§ Single Event:', event);
              },
              pushBatch: (events) => {
                const output = document.getElementById('console-output');

                // Add batch header
                const batchHeader = document.createElement('div');
                batchHeader.className = 'batch-indicator';
                batchHeader.innerHTML = `üì¶ BATCH SENT: ${events.length} events`;
                output.insertBefore(batchHeader, output.firstChild);

                // Add each event in the batch
                events.forEach((event, index) => {
                  const entry = document.createElement('div');
                  entry.className = 'console-entry';
                  entry.style.background = '#e3f2fd';
                  entry.innerHTML = `
                  <strong>[${index + 1}/${events.length}] ${event.event}</strong><br>
                  Product: ${event.data.name || 'Unknown'}<br>
                  Batched at: ${new Date().toLocaleTimeString()}
                `;
                  output.insertBefore(entry, output.firstChild);
                });

                console.log('üì¶ Batched Events:', events);
              },
            },
          },
        },
        browser: {
          run: true,
          session: true,
        },
      });
    </script>
  </body>
</html>
