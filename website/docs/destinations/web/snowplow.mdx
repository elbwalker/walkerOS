---
title: Snowplow
description: Behavioral data platform destination with ecommerce tracking
path: /docs/destinations/web/snowplow
sidebar_position: 4
package: '@walkeros/web-destination-snowplow'
---

import { getEvent } from '@walkeros/core';
import destinationSnowplow from '@walkeros/web-destination-snowplow';
import { examples, schemas } from '@walkeros/web-destination-snowplow/dev';

export const destination = { ...destinationSnowplow, examples };

# Snowplow

<PackageLink
  env="web"
  github="packages/web/destinations/snowplow"
  npm="@walkeros/web-destination-snowplow"
/>

[Snowplow](https://snowplow.io/) is a behavioral data platform for collecting
and routing event data. The destination sends events via the browser tracker,
supporting both the npm `@snowplow/browser-tracker` and the JavaScript tracker
(`sp.js`). walkerOS handles tracker initialization, plugin loading, activity
tracking, and event mapping.

:::info Where This Fits
Snowplow is a **web destination** in the walkerOS flow:

<FlowMap
  sources={{ default: { highlight: false } }}
  collector={{ highlight: false }}
  destinations={{ default: { label: 'Destination', text: 'Snowplow', highlight: true } }}
/>

Initializes the Snowplow tracker, loads plugins, enables activity tracking (page pings), and sends self-describing events with ecommerce context entities.
:::

## Installation

<CodeSnippet
  code={`npm install @walkeros/web-destination-snowplow`}
  language="bash"
/>

## Setup

<Tabs groupId="mode">
  <TabItem value="integrated" label="Integrated" default>

<CodeSnippet
  code={`import { startFlow } from '@walkeros/collector';
import { destinationSnowplow } from '@walkeros/web-destination-snowplow';

const { collector, elb } = await startFlow({
  destinations: {
    snowplow: {
      code: destinationSnowplow,
      config: {
        settings: {
          collectorUrl: 'https://collector.example.com',
          appId: 'my-app',
        },
        loadScript: true,
      },
    },
  },
});`}
  language="typescript"
/>

  </TabItem>
  <TabItem value="bundled" label="Bundled">

Add to your `flow.json` destinations:

<CodeSnippet
  code={`"destinations": {
  "snowplow": {
    "package": "@walkeros/web-destination-snowplow",
    "config": {
      "settings": {
        "collectorUrl": "https://collector.example.com",
        "appId": "my-app"
      },
      "loadScript": true
    }
  }
}`}
  language="json"
/>

[See Bundled Mode setup →](/docs/getting-started/modes/bundled) | [CLI reference →](/docs/apps/cli)

  </TabItem>
</Tabs>

## Configuration reference

<PropertyTable schema={schemas.settings} />

#### Example

<DestinationInitDemo
  destination={destination}
  settings={{
    collectorUrl: 'https://collector.example.com',
    appId: 'my-app',
  }}
/>

### Event Mapping

For custom event mapping (`mapping.entity.action.settings`):

<PropertyTable schema={schemas.mapping} />

## User Identity & Privacy

### Cross-Session User Stitching

Use `userId` to link events across sessions when users log in. The ID is set once via Snowplow's `setUserId()` on the first event where the value resolves:

<CodeSnippet
  code={`{
  collectorUrl: 'https://collector.example.com',
  userId: 'user.id', // From walkerOS user object
}`}
  language="typescript"
/>

The `userId` setting supports walkerOS mapping syntax:

- `'user.id'` - From walkerOS user object (recommended)
- `'globals.user_id'` - From globals

### Anonymous Tracking

Enable anonymous tracking for privacy-focused collection or before consent:

<CodeSnippet
  code={`{
  collectorUrl: 'https://collector.example.com',
  anonymousTracking: {
    withServerAnonymisation: true, // Anonymize IP on server
    withSessionTracking: true,     // Keep session context
  },
}`}
  language="typescript"
/>

### Runtime Privacy Controls

Control tracking modes at runtime using exported utility functions:

<CodeSnippet
  code={`import {
  clearUserData,
  enableAnonymousTracking,
  disableAnonymousTracking,
} from '@walkeros/web-destination-snowplow';

// User withdraws consent - clear all identifiers
clearUserData();

// Switch to anonymous mode mid-session
enableAnonymousTracking({ withServerAnonymisation: true });

// User grants consent - resume normal tracking
disableAnonymousTracking();`}
  language="typescript"
/>

### Consent Tracking

Track GDPR/CCPA consent events using Snowplow's [Enhanced Consent plugin](https://docs.snowplow.io/docs/collecting-data/collecting-from-own-applications/javascript-trackers/web-tracker/tracking-events/consent-gdpr/). The destination automatically reacts to walkerOS consent events and calls the appropriate Snowplow consent methods.

**Prerequisites:** Load the Enhanced Consent plugin via the `plugins` setting or include it in your Snowplow script bundle.

<CodeSnippet
  code={`{
  collectorUrl: 'https://collector.example.com',
  consent: {
    required: ['analytics', 'marketing'],
    basisForProcessing: 'consent',
    consentUrl: 'https://example.com/privacy',
    consentVersion: '2.0',
    domainsApplied: ['example.com'],
    gdprApplies: true,
  },
}`}
  language="typescript"
/>

| Option | Type | Description |
|--------|------|-------------|
| `required` | `string[]` | walkerOS consent groups to check |
| `basisForProcessing` | `string` | GDPR basis: `consent`, `contract`, `legal_obligation`, `vital_interests`, `public_task`, `legitimate_interests` |
| `consentUrl` | `string` | Privacy policy URL |
| `consentVersion` | `string` | Policy version |
| `domainsApplied` | `string[]` | Domains where consent applies |
| `gdprApplies` | `boolean` | Whether GDPR applies |

The destination maps walkerOS consent state to Snowplow methods:

| walkerOS Consent State | Snowplow Method |
|------------------------|-----------------|
| All required scopes granted | `trackConsentAllow` |
| All required scopes denied | `trackConsentDeny` |
| Partial consent (mixed) | `trackConsentSelected` |

<CodeSnippet
  code={`// User accepts all required scopes
await elb('walker consent', { analytics: true, marketing: true });
// → trackConsentAllow called

// User accepts some scopes
await elb('walker consent', { analytics: true, marketing: false });
// → trackConsentSelected called

// User rejects all scopes
await elb('walker consent', { analytics: false, marketing: false });
// → trackConsentDeny called`}
  language="typescript"
/>

## Schema Constants

The package exports pre-defined Snowplow schema URIs for use in custom mappings:

<CodeSnippet
  code={`import { SCHEMAS, ACTIONS, WEB_SCHEMAS, CONSENT_SCHEMAS } from '@walkeros/web-destination-snowplow';

// Ecommerce schemas
SCHEMAS.PRODUCT;     // product/jsonschema/1-0-0
SCHEMAS.TRANSACTION; // transaction/jsonschema/1-0-0

// Ecommerce actions
ACTIONS.ADD_TO_CART; // 'add_to_cart'
ACTIONS.TRANSACTION; // 'transaction'

// Web event schemas
WEB_SCHEMAS.LINK_CLICK;  // link_click/jsonschema/1-0-1
WEB_SCHEMAS.SUBMIT_FORM; // submit_form/jsonschema/1-0-0
WEB_SCHEMAS.SITE_SEARCH; // site_search/jsonschema/1-0-0
WEB_SCHEMAS.TIMING;      // timing/jsonschema/1-0-0
WEB_SCHEMAS.WEB_VITALS;  // web_vitals/jsonschema/1-0-0

// Web context schemas
WEB_SCHEMAS.WEB_PAGE;       // web_page/jsonschema/1-0-0
WEB_SCHEMAS.BROWSER;        // browser_context/jsonschema/2-0-0
WEB_SCHEMAS.CLIENT_SESSION; // client_session/jsonschema/1-0-2
WEB_SCHEMAS.GEOLOCATION;    // geolocation_context/jsonschema/1-1-0

// Consent schemas (Enhanced Consent plugin)
CONSENT_SCHEMAS.PREFERENCES; // consent_preferences/jsonschema/1-0-0
CONSENT_SCHEMAS.CMP_VISIBLE; // cmp_visible/jsonschema/1-0-0
CONSENT_SCHEMAS.DOCUMENT;    // consent_document/jsonschema/1-0-0
CONSENT_SCHEMAS.GDPR;        // gdpr/jsonschema/1-0-0`}
  language="typescript"
/>

## Advanced Configuration

### Tracker Settings

Configure Snowplow tracker behavior including cookie settings and built-in contexts:

<CodeSnippet
  code={`{
  collectorUrl: 'https://collector.example.com',
  appId: 'my-app',
  appVersion: '1.0.0',
  discoverRootDomain: true,
  cookieSameSite: 'Lax',
  contexts: {
    webPage: true,
    session: true,
    performanceTiming: true,
    geolocation: false,
  },
}`}
  language="typescript"
/>

### Activity Tracking (Page Pings)

Enable activity tracking to measure user engagement through page pings:

<CodeSnippet
  code={`{
  collectorUrl: 'https://collector.example.com',
  activityTracking: {
    minimumVisitLength: 10, // seconds before first ping
    heartbeatDelay: 30,     // seconds between pings
  },
}`}
  language="typescript"
/>

### Plugins

Load Snowplow plugins for automatic tracking of links, buttons, and forms. Supports both URL-based plugins (sp.js) and npm BrowserPlugin instances:

<CodeSnippet
  code={`{
  collectorUrl: 'https://collector.example.com',
  plugins: [
    // URL-based plugin (sp.js approach)
    {
      url: 'https://cdn.jsdelivr.net/npm/@snowplow/browser-plugin-link-click-tracking@latest/dist/index.umd.min.js',
      name: ['snowplowLinkClickTracking', 'LinkClickTrackingPlugin'],
      options: { trackContent: true },
    },
    {
      url: 'https://cdn.jsdelivr.net/npm/@snowplow/browser-plugin-form-tracking@latest/dist/index.umd.min.js',
      name: ['snowplowFormTracking', 'FormTrackingPlugin'],
    },
  ],
}`}
  language="typescript"
/>

The enable method is derived automatically from the plugin name (`LinkClickTrackingPlugin` → `enableLinkClickTracking`). Override with `enableMethod` if needed.

### Global Contexts

Attach context entities to all events. Supports static objects and dynamic generator functions:

<CodeSnippet
  code={`{
  collectorUrl: 'https://collector.example.com',
  globalContexts: [
    // Static context
    {
      schema: 'iglu:com.example/app_info/jsonschema/1-0-0',
      data: { version: '1.0.0', environment: 'production' },
    },
    // Dynamic context (e.g., consent state)
    () => ({
      schema: 'iglu:com.example/consent/jsonschema/1-0-0',
      data: {
        advertising: document.cookie.includes('ads_consent=1'),
      },
    }),
  ],
}`}
  language="typescript"
/>

## Full Replacement Example

Replace native Snowplow tracker calls with a single walkerOS configuration:

<CodeSnippet
  code={`import { startFlow } from '@walkeros/collector';
import { destinationSnowplow } from '@walkeros/web-destination-snowplow';

await startFlow({
  destinations: {
    snowplow: {
      code: destinationSnowplow,
      config: {
        settings: {
          collectorUrl: 'https://collector.example.com',
          appId: 'my-app',
          appVersion: '1.0.0',
          userId: 'user.id',
          discoverRootDomain: true,
          cookieSameSite: 'Lax',
          contexts: {
            session: true,
            performanceTiming: true,
          },
          activityTracking: {
            minimumVisitLength: 10,
            heartbeatDelay: 30,
          },
          plugins: [
            {
              url: 'https://cdn.jsdelivr.net/npm/@snowplow/browser-plugin-link-click-tracking@latest/dist/index.umd.min.js',
              name: ['snowplowLinkClickTracking', 'LinkClickTrackingPlugin'],
              options: { trackContent: true },
            },
            {
              url: 'https://cdn.jsdelivr.net/npm/@snowplow/browser-plugin-form-tracking@latest/dist/index.umd.min.js',
              name: ['snowplowFormTracking', 'FormTrackingPlugin'],
            },
          ],
          globalContexts: [
            () => ({
              schema: 'iglu:com.example/consent/jsonschema/1-0-0',
              data: { advertising: document.cookie.includes('ads=1') },
            }),
          ],
        },
        loadScript: true,
      },
    },
  },
});`}
  language="typescript"
/>

## Mapping examples

:::tip

The code examples are interactive. You can edit the code to generate your
individual event mapping.

:::

Learn more about
[Snowplow Ecommerce tracking](https://docs.snowplow.io/docs/collecting-data/collecting-from-own-applications/javascript-trackers/web-tracker/tracking-events/ecommerce/).

### Product View

Map your walkerOS event to get a Snowplow `product_view` ecommerce event with product context.

<DestinationDemo
  destination={destination}
  settings={{
    collectorUrl: 'https://collector.example.com',
  }}
  smallText={true}
  height={'512px'}
  event={getEvent('product view')}
  mapping={examples.mapping.productView}
  generic={true}
/>

### Add to Cart

Map your walkerOS event to get a Snowplow `add_to_cart` ecommerce event with product, cart, page, and user context entities.

<DestinationDemo
  destination={destination}
  settings={{
    collectorUrl: 'https://collector.example.com',
  }}
  smallText={true}
  height={'512px'}
  event={getEvent('product add')}
  mapping={examples.mapping.addToCart}
  generic={true}
/>

### Transaction

Map your walkerOS event to get a Snowplow `transaction` ecommerce event with transaction context.

<DestinationDemo
  destination={destination}
  settings={{
    collectorUrl: 'https://collector.example.com',
  }}
  smallText={true}
  height={'512px'}
  event={getEvent('order complete')}
  mapping={examples.mapping.transaction}
  generic={true}
/>

### Promotion Visible

Map your walkerOS event to get a Snowplow `promo_view` ecommerce event with promotion context.

<DestinationDemo
  destination={destination}
  settings={{
    collectorUrl: 'https://collector.example.com',
  }}
  smallText={true}
  height={'512px'}
  event={getEvent('promotion visible')}
  mapping={examples.mapping.promoView}
  generic={true}
/>

## Testing with Snowplow Micro

Use [Snowplow Micro](https://docs.snowplow.io/docs/testing-debugging/snowplow-micro/basic-usage/) for local development:

<CodeSnippet
  code={`docker run -p 9090:9090 snowplow/snowplow-micro`}
  language="bash"
/>

Configure the destination with `collectorUrl: 'http://localhost:9090'` and view events at `http://localhost:9090/micro/ui`.
