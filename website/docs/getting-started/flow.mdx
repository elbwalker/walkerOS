---
title: Flow Configuration
description: Understanding the walkerOS flow configuration file structure
sidebar_position: 4
---

# Flow Configuration

Flow configuration is walkerOS's **"configuration as code"** approach. A single JSON file defines your entire event collection pipeline—sources, collector, destinations, and packages—making it portable, version-controlled, and deployable across environments.

## Philosophy

If you're familiar with **Segment**, **Jitsu**, or **Amplitude**—think of flow configuration as your sources, destinations, and transformation rules defined in one file instead of a web UI. This approach provides:

- **Version control**: Track changes in git like any other code
- **Reproducibility**: Same config = same behavior across environments
- **Portability**: Move between local, staging, and production seamlessly
- **Transparency**: No hidden settings in external dashboards

## Configuration Structure

A flow configuration uses the `Flow.Setup` format with two required fields:

1. **`version`** - Schema version (currently `1`)
2. **`flows`** - Named flow configurations

### Basic Example

<CodeSnippet
  code={`{
  "version": 1,
  "flows": {
    "default": {
      "server": {},
      "packages": {
        "@walkeros/collector": { "imports": ["startFlow"] },
        "@walkeros/server-source-express": { "imports": ["sourceExpress"] },
        "@walkeros/destination-demo": { "imports": ["destinationDemo"] }
      },
      "sources": {
        "http": {
          "package": "@walkeros/server-source-express",
          "config": {
            "settings": {
              "path": "/collect",
              "port": 8080
            }
          }
        }
      },
      "destinations": {
        "console": {
          "package": "@walkeros/destination-demo",
          "config": {
            "settings": {
              "name": "Console Logger"
            }
          }
        }
      },
      "collector": {
        "run": true
      }
    }
  }
}`}
  language="json"
/>

This creates an HTTP event collection endpoint that logs events to the console.

## Flow Configuration (Flow.Config)

Each flow in `flows` is a `Flow.Config` that defines runtime behavior.

### Platform

Platform is determined by the presence of the `web` or `server` key:

<CodeSnippet
  code={`{
  "version": 1,
  "flows": {
    "default": {
      "server": {}  // Server platform (Node.js)
    }
  }
}`}
  language="json"
/>

<CodeSnippet
  code={`{
  "version": 1,
  "flows": {
    "default": {
      "web": {}  // Web platform (browser)
    }
  }
}`}
  language="json"
/>

**Platform options:**
- `"server": {}` - Node.js server environment (HTTP endpoints, cloud functions)
- `"web": {}` - Browser environment (client-side tracking)

The CLI automatically applies platform-specific build defaults:
- **Web**: IIFE format, ES2020 target, output to `./dist/walker.js`
- **Server**: ESM format, Node20 target, output to `./dist/bundle.mjs`

### Packages

Specifies npm packages to download and bundle:

<CodeSnippet
  code={`{
  "packages": {
    "@walkeros/collector": {
      "version": "latest",
      "imports": ["startFlow"]
    },
    "@walkeros/server-source-express": {
      "version": "0.4.0",
      "imports": ["sourceExpress"]
    },
    "@walkeros/destination-demo": {
      "imports": ["destinationDemo", "destinationDemo2"]
    }
  }
}`}
  language="json"
/>

**Properties:**
- **`version`** - npm version (semver or "latest", defaults to "latest")
- **`imports`** - Array of named exports to import

### Sources

Sources capture events from various inputs. Each source needs:
- **`package`** - The npm package (with optional version)
- **`config`** - Source-specific settings

<CodeSnippet
  code={`{
  "sources": {
    "http": {
      "package": "@walkeros/server-source-express",
      "config": {
        "settings": {
          "path": "/collect",
          "port": 8080,
          "cors": true
        }
      }
    }
  }
}`}
  language="json"
/>

**Common Sources:**
- `@walkeros/server-source-express` - HTTP event collection endpoint
- `@walkeros/web-source-browser` - Browser DOM event tracking
- `@walkeros/web-source-dataLayer` - DataLayer integration

See [Sources documentation](/docs/sources/) for all available options.

### Destinations

Destinations receive processed events and send them to analytics tools, databases, or APIs:

<CodeSnippet
  code={`{
  "destinations": {
    "bigquery": {
      "package": "@walkeros/server-destination-gcp",
      "config": {
        "settings": {
          "projectId": "my-project",
          "datasetId": "analytics",
          "tableId": "events"
        },
        "mapping": {
          "page": {
            "view": {
              "name": "page_view"
            }
          }
        }
      }
    },
    "console": {
      "package": "@walkeros/destination-demo",
      "config": {
        "settings": {
          "name": "Debug Logger"
        }
      }
    }
  }
}`}
  language="json"
/>

**Configuration options:**
- **`settings`** - Destination-specific configuration (API keys, endpoints, etc.)
- **`mapping`** - Event transformation rules (see [Mapping documentation](/docs/mapping))
- **`consent`** - Required consent states
- **`policy`** - Processing rules

**Common Destinations:**
- `@walkeros/destination-demo` - Console logging (great for testing)
- `@walkeros/server-destination-gcp` - Google BigQuery
- `@walkeros/server-destination-aws` - AWS services
- `@walkeros/web-destination-gtag` - Google Analytics 4
- `@walkeros/web-destination-meta-pixel` - Meta Pixel

See [Destinations documentation](/docs/destinations/) for all available options.

### Collector

The collector processes events from sources and routes them to destinations:

<CodeSnippet
  code={`{
  "collector": {
    "run": true,
    "globals": {
      "environment": "production"
    },
    "consent": {
      "functional": true
    }
  }
}`}
  language="json"
/>

**Options:**
- **`run`** - Whether to start the collector automatically (default: `true`)
- **`globals`** - Properties added to every event
- **`consent`** - Default consent state

See [Collector documentation](/docs/collector/) for complete options.

### Web-Specific Options

For browser bundles, you can configure window variable names:

<CodeSnippet
  code={`{
  "web": {
    "windowCollector": "walkerCollector",
    "windowElb": "elb"
  }
}`}
  language="json"
/>

**Properties:**
- **`windowCollector`** - Global variable name for collector instance (default: `"collector"`)
- **`windowElb`** - Global variable name for event tracking function (default: `"elb"`)

## Multi-Flow Configuration

For managing dev/staging/production flows in one file:

<CodeSnippet
  code={`{
  "version": 1,
  "variables": {
    "GA_ID": "G-XXXXXXXXXX"
  },
  "flows": {
    "development": {
      "server": {},
      "packages": {
        "@walkeros/collector": { "imports": ["startFlow"] },
        "@walkeros/destination-demo": { "imports": ["destinationDemo"] }
      },
      "destinations": {
        "console": {
          "package": "@walkeros/destination-demo",
          "config": {
            "settings": { "name": "Dev Logger" }
          }
        }
      },
      "collector": { "run": true }
    },
    "production": {
      "server": {},
      "packages": {
        "@walkeros/collector": { "imports": ["startFlow"] },
        "@walkeros/server-destination-gcp": { "imports": ["destinationGCP"] }
      },
      "destinations": {
        "bigquery": {
          "package": "@walkeros/server-destination-gcp",
          "config": {
            "settings": {
              "projectId": "prod-project"
            }
          }
        }
      },
      "collector": { "run": true }
    }
  }
}`}
  language="json"
/>

Build specific flows using the CLI:

<CodeSnippet
  code={`# Build development flow
walkeros bundle config.json --flow development

# Build production flow
walkeros bundle config.json --flow production

# Build all flows
walkeros bundle config.json --all`}
  language="bash"
/>

## Variables and Definitions

### Variables

Variables allow dynamic values with environment variable support:

<CodeSnippet
  code={`{
  "version": 1,
  "variables": {
    "GA_ID": "\${GA_MEASUREMENT_ID:G-DEFAULT}",
    "API_ENDPOINT": "/collect"
  },
  "flows": {
    "default": {
      "web": {},
      "destinations": {
        "gtag": {
          "package": "@walkeros/web-destination-gtag",
          "config": {
            "settings": {
              "ga4": { "measurementId": "\${GA_ID}" }
            }
          }
        }
      }
    }
  }
}`}
  language="json"
/>

**Variable syntax:**
- `${VAR_NAME}` - Required variable
- `${VAR_NAME:default}` - Variable with default value

**Resolution order:**
1. `process.env` (environment variables)
2. Config-level `variables`
3. Setup-level `variables`
4. Inline default value

### Definitions

Definitions allow reusable configuration blocks:

<CodeSnippet
  code={`{
  "version": 1,
  "definitions": {
    "commonMapping": {
      "page": {
        "view": { "name": "page_view" }
      }
    }
  },
  "flows": {
    "default": {
      "web": {},
      "destinations": {
        "gtag": {
          "package": "@walkeros/web-destination-gtag",
          "config": {
            "mapping": { "$ref": "#/definitions/commonMapping" }
          }
        }
      }
    }
  }
}`}
  language="json"
/>

## Type Hierarchy

walkerOS uses a clear type hierarchy:

```
┌─────────────────────────────────────────────────────────────────┐
│  Flow.Setup (config file)                                       │
│  ├── version: 1                                                 │
│  ├── variables?: { GA_ID: "G-XXX" }                            │
│  ├── definitions?: { commonMapping: {...} }                     │
│  └── flows:                                                     │
│       └── default: Flow.Config                                  │
└─────────────────────────────────────────────────────────────────┘
                              │
                              │ CLI resolves variables, $refs
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  Flow.Config (resolved flow)                                    │
│  ├── web: {} or server: {}                                      │
│  ├── packages: { ... }                                          │
│  ├── sources: { ... }                                           │
│  ├── destinations: { ... }                                      │
│  └── collector: { ... }                                         │
└─────────────────────────────────────────────────────────────────┘
                              │
                              │ CLI bundles and transforms
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  Collector.InitConfig (runtime)                                 │
│  Passed to startFlow() at runtime                               │
└─────────────────────────────────────────────────────────────────┘
```

- **`Flow.Setup`** - Root config file format for CLI
- **`Flow.Config`** - Single flow configuration
- **`Collector.InitConfig`** - Runtime type passed to `startFlow()`

## Complete Example

Here's a production-ready flow that accepts HTTP events and sends them to BigQuery:

<CodeSnippet
  code={`{
  "version": 1,
  "flows": {
    "default": {
      "server": {},
      "packages": {
        "@walkeros/collector": { "imports": ["startFlow"] },
        "@walkeros/server-source-express": { "imports": ["sourceExpress"] },
        "@walkeros/server-destination-gcp": { "imports": ["destinationGCP"] },
        "@walkeros/destination-demo": { "imports": ["destinationDemo"] }
      },
      "sources": {
        "http": {
          "package": "@walkeros/server-source-express",
          "config": {
            "settings": {
              "path": "/collect",
              "port": 8080,
              "cors": true
            }
          }
        }
      },
      "destinations": {
        "bigquery": {
          "package": "@walkeros/server-destination-gcp",
          "config": {
            "settings": {
              "projectId": "my-analytics-project",
              "datasetId": "events",
              "tableId": "raw_events"
            },
            "mapping": {
              "page": {
                "view": {
                  "name": "page_view",
                  "data": {
                    "map": {
                      "page_title": "data.title",
                      "page_path": "data.path",
                      "timestamp": "timestamp"
                    }
                  }
                }
              },
              "product": {
                "view": { "name": "product_view" },
                "add": { "name": "add_to_cart" }
              }
            }
          }
        },
        "console": {
          "package": "@walkeros/destination-demo",
          "config": {
            "settings": {
              "name": "Debug Logger",
              "values": ["name", "data", "timestamp"]
            }
          }
        }
      },
      "collector": {
        "run": true,
        "globals": {
          "environment": "production",
          "version": "1.0.0"
        }
      }
    }
  }
}`}
  language="json"
/>

## Programmatic Usage

You can also use configuration programmatically with the `startFlow` function:

<CodeSnippet
  code={`import { startFlow } from '@walkeros/collector';
import { sourceExpress } from '@walkeros/server-source-express';
import { destinationDemo } from '@walkeros/destination-demo';

const { collector, elb } = await startFlow({
  sources: {
    http: {
      ...sourceExpress,
      config: {
        settings: { path: '/collect', port: 8080 }
      }
    }
  },
  destinations: {
    console: {
      ...destinationDemo,
      config: {
        settings: { name: 'Logger' }
      }
    }
  },
  run: true
});

// Collector is now running and ready to process events`}
  language="typescript"
/>

See the [Collector documentation](/docs/collector/) for complete API reference.

## Next Steps

- **[CLI](/docs/apps/cli)** - Learn how to bundle and test flows
- **[Docker](/docs/apps/docker)** - Deploy flows in containers
- **[Sources](/docs/sources/)** - Explore available event sources
- **[Destinations](/docs/destinations/)** - Configure analytics destinations
- **[Mapping](/docs/mapping)** - Transform events for destinations
