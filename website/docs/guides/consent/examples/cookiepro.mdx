---
title: CookiePro by OneTrust
description: Integrate CookiePro/OneTrust consent management with walkerOS using the source package or manual event listener
sidebar_position: 2
---

## Using the source package (recommended)

The easiest way to integrate CookiePro/OneTrust with walkerOS is using the
`@walkeros/web-source-cmp-cookiepro` package:

```bash
npm install @walkeros/web-source-cmp-cookiepro
```

```typescript
import { createCollector } from '@walkeros/collector';
import { sourceCookiePro } from '@walkeros/web-source-cmp-cookiepro';

const collector = createCollector({
  sources: {
    consent: {
      code: sourceCookiePro,
      config: {
        settings: {
          // Default mapping covers standard OneTrust categories:
          // C0001 -> functional, C0002 -> analytics,
          // C0003 -> functional, C0004 -> marketing, C0005 -> marketing
          categoryMap: {
            C0002: 'statistics', // Override if needed
          },
        },
      },
    },
  },
});
```

The source automatically:
- Detects if the OneTrust SDK is already loaded and reads existing consent
- Wraps `OptanonWrapper` to capture SDK initialization (preserves existing wrapper)
- Listens for `OneTrustGroupsUpdated` events on consent changes
- Maps category IDs through `categoryMap` to walkerOS consent groups
- Sets explicit `true`/`false` for all mapped groups
- Calls `elb('walker consent', state)` with the mapped state
- Filters implicit consent by default (`explicitOnly: true`)

## Manual event listener

If you prefer a manual approach without the source package, CookiePro registers
cookies and assigns them to categories. Those categories can be mapped to match
the walker.js consent groups.

![CookiePro categorizations](./cookiepro-categorizations.png)

The following code works asynchronously with CookiePro's
[OptanonActiveGroups](https://my.onetrust.com/s/article/UUID-66bcaaf1-c7ca-5f32-6760-c75a1337c226).
The code won't override an eventually existing `OptanonWrapper`. The `mapping`
translated the CookiePro categories to the walker.js consent groups and is an
example of how to map the CookiePro categories to the walker.js

<CodeSnippet
  code={`(function (wrapper) {
// Renaming of the categories
const mapping = {
C0001: 'functional', // necessary
C0002: 'analytics', // performance
C0003: 'analytics', // functional
C0004: 'marketing', // targeting
C0005: 'marketing', // social
};

function handleConsent() {
// if (!OneTrust.IsAlertBoxClosed()) return; // Process only explicit consent

const consent = {};
window.OptanonActiveGroups.split(',').forEach((category) => {
const name = mapping[category];
if (name) consent[name] = true;
});

elb('walker consent', consent);
}

if (window.Optanon && window.OptanonActiveGroups) {
handleConsent(); // CMP already loaded
} else {
window.OptanonWrapper = function (e) {
if (wrapper) wrapper(); // Call the original OptanonWrapper
handleConsent();
};
}

// Listen for consent updates
window.addEventListener('OneTrustGroupsUpdated', function (event) {
handleConsent();
});
})(window.OptanonWrapper);`}
  language="javascript"
/>

Adjust the mapping according to the CookiePro categories and the associated
tools.

Optionally uncomment the `IsAlertBoxClosed` check to process explicit consent
only. This will prevent the walker.js from starting unintentionally or running
eventually running twice.

Ensure the [elb](/docs/sources/web/browser/commands#elb) function is available.
