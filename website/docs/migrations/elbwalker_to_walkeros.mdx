---
title: '@elbwalker to @walkerOS'
description: How to migrate from @elbwalker to @walkerOS
position: 1
---

# Migration Guide: From @elbwalker to @walkerOS

This guide helps you migrate from the old elbwalker packages to the new walkerOS
packages. The migration involves package name changes, updated exports, and some
structural reorganization.

## Package Migration Map

### Core Architecture Changes

The new walkerOS architecture introduces a **unified collector** approach with
modular sources and destinations:

| Old Package              | New Package(s)                       | Migration Notes                               |
| ------------------------ | ------------------------------------ | --------------------------------------------- |
| `@elbwalker/walker.js`   | `@walkerOS/collector` + web sources  | Split into unified collector + browser source |
| `@elbwalker/source-node` | `@walkerOS/collector` + server utils | Unified collector for all platforms           |

**Key Architectural Changes:**

1. **Unified Collector**: One `@walkerOS/collector` package works across all
   platforms
2. **Modular Sources**: Browser DOM tracking is now
   `@walkerOS/web-source-browser`
3. **Platform Cores**: `@walkerOS/web-core` and `@walkerOS/server-core` provide
   platform-specific utilities
4. **Cleaner Separation**: Core logic, platform utilities, sources, and
   destinations are clearly separated

### Web Destinations

| Old Package                             | New Package                            | Key Changes                                             |
| --------------------------------------- | -------------------------------------- | ------------------------------------------------------- |
| `@elbwalker/destination-web-api`        | `@walkerOS/web-destination-api`        | Export: `DestinationWebAPI` → `DestinationAPI`          |
| `@elbwalker/destination-web-google-ga4` | `@walkerOS/web-destination-ga4`        | Export: `DestinationGoogleGA4` → `DestinationGA4`       |
| `@elbwalker/destination-web-google-ads` | `@walkerOS/web-destination-google_ads` | Export: `DestinationGoogleAds` → `DestinationAds`       |
| `@elbwalker/destination-web-google-gtm` | `@walkerOS/web-destination-gtm`        | Export: `DestinationGoogleGTM` → `DestinationGTM`       |
| `@elbwalker/destination-web-meta-pixel` | `@walkerOS/web-destination-meta`       | Export: `DestinationMetaPixel` → `DestinationMetaPixel` |
| `@elbwalker/destination-web-piwikpro`   | `@walkerOS/web-destination-piwikpro`   | Export: `DestinationPiwikPro` → `DestinationPiwikPro`   |
| `@elbwalker/destination-web-plausible`  | `@walkerOS/web-destination-plausible`  | Export: `DestinationPlausible` → `DestinationPlausible` |

### Server Destinations

| Old Package                            | New Package                         | Key Changes                                           |
| -------------------------------------- | ----------------------------------- | ----------------------------------------------------- |
| `@elbwalker/destination-node-aws`      | `@walkerOS/server-destination-aws`  | Export: `DestinationFirehose` → `DestinationFirehose` |
| `@elbwalker/destination-node-bigquery` | `@walkerOS/server-destination-gcp`  | Export: `DestinationBigQuery` → `DestinationBigQuery` |
| `@elbwalker/destination-node-meta`     | `@walkerOS/server-destination-meta` | Export: `DestinationMeta` → `DestinationMeta`         |

### Sources

| Old Package                   | New Package                      | Key Changes                                   |
| ----------------------------- | -------------------------------- | --------------------------------------------- |
| `@elbwalker/source-datalayer` | `@walkerOS/web-source-dataLayer` | Export: `SourceDataLayer` → `SourceDataLayer` |
| Built into `walker.js`        | `@walkerOS/web-source-browser`   | DOM tracking extracted to dedicated source    |

### Core and Utility Packages

| Old Package         | New Package(s)          | Key Changes                                                 |
| ------------------- | ----------------------- | ----------------------------------------------------------- |
| `@elbwalker/types`  | `@walkerOS/core`        | Merged with utils into unified core package                 |
| `@elbwalker/utils`  | `@walkerOS/core`        | Merged with types into unified core package                 |
| `@elbwalker/tagger` | Built into web sources  | Now included in `@walkerOS/web-source-browser`              |
| N/A                 | `@walkerOS/collector`   | **New**: Unified platform-agnostic collector                |
| N/A                 | `@walkerOS/web-core`    | **New**: Web-specific utilities (browser, storage, session) |
| N/A                 | `@walkerOS/server-core` | **New**: Server-specific utilities                          |

### New Package Architecture

The walkerOS architecture now follows a **layered approach**:

#### 1. **Core Foundation**

- `@walkerOS/core` - Platform-agnostic types and utilities (no dependencies)
- Contains all TypeScript definitions, helper functions, and shared logic

#### 2. **Unified Collector**

- `@walkerOS/collector` - Single collector that works across all platforms
- Handles event processing, consent, destinations, and source management
- Depends only on `@walkerOS/core`

#### 3. **Platform Cores**

- `@walkerOS/web-core` - Web-specific utilities (DOM, storage, sessions)
- `@walkerOS/server-core` - Server-specific utilities
- Both depend on `@walkerOS/core`

#### 4. **Sources and Destinations**

- Sources depend on: `@walkerOS/collector` + platform core
- Destinations depend on: platform core only

**Key Benefits:**

- **Cleaner dependencies**: Clear separation between core, platform, and
  implementations
- **Unified collector**: Same event processing logic across all platforms
- **Modular sources**: Choose only the sources you need (browser DOM, dataLayer,
  etc.)
- **Smaller bundles**: Import only what you use

## Step-by-Step Migration

### 1. Update Package Dependencies

**Before:**

```json
{
  "dependencies": {
    "@elbwalker/walker.js": "^2.0.0",
    "@elbwalker/destination-web-google-ga4": "^2.0.0",
    "@elbwalker/destination-web-api": "^2.0.0",
    "@elbwalker/tagger": "^2.0.0",
    "@elbwalker/types": "^2.0.0",
    "@elbwalker/utils": "^2.0.0"
  }
}
```

**After (Web Setup):**

```json
{
  "dependencies": {
    "@walkerOS/collector": "^0.0.7",
    "@walkerOS/web-source-browser": "^0.0.7",
    "@walkerOS/web-destination-ga4": "^0.0.7",
    "@walkerOS/web-destination-api": "^0.0.7"
  }
}
```

**After (Server Setup):**

```json
{
  "dependencies": {
    "@walkerOS/collector": "^0.0.7",
    "@walkerOS/server-destination-aws": "^0.0.7",
    "@walkerOS/server-destination-meta": "^0.0.7"
  }
}
```

**Note**: For custom implementations, add `@walkerOS/core` for types/utilities:

```json
{
  "dependencies": {
    "@walkerOS/core": "^0.0.7",
    "@walkerOS/collector": "^0.0.7"
  }
}
```

### 2. Update Imports

**Before:**

```typescript
import { Walkerjs, createSourceWalkerjs } from '@elbwalker/walker.js';
import { destinationGoogleGA4 } from '@elbwalker/destination-web-google-ga4';
import { destinationWebAPI } from '@elbwalker/destination-web-api';
import { default as tagger } from '@elbwalker/tagger';
import type { WalkerOS } from '@elbwalker/types';
import { isObject, assign } from '@elbwalker/utils';
```

**After (Web Setup):**

```typescript
import { collector } from '@walkerOS/collector';
import { sourceBrowser } from '@walkerOS/web-source-browser';
import { destinationGA4 } from '@walkerOS/web-destination-ga4';
import { destinationAPI } from '@walkerOS/web-destination-api';
import type { WalkerOS, Elb } from '@walkerOS/core';
import { isObject, assign } from '@walkerOS/core';
```

**After (Server Setup):**

```typescript
import { collector } from '@walkerOS/collector';
import { destinationFirehose } from '@walkerOS/server-destination-aws';
import { destinationMeta } from '@walkerOS/server-destination-meta';
import type { WalkerOS } from '@walkerOS/core';
import { isObject, assign } from '@walkerOS/core';
```

**Key Import Changes:**

- **Unified Collector**: `collector` function from `@walkerOS/collector`
  replaces both web and node variants
- **Explicit Sources**: Import sources separately (e.g., `sourceBrowser` for DOM
  tracking)
- **Core Types**: All types now come from `@walkerOS/core`
- **Tagger**: Now part of `@walkerOS/web-source-browser` (no separate import
  needed)

### 3. Update Function Calls

**Before:**

```typescript
const walker = Walkerjs({
  destinations: [destinationGoogleGA4, destinationWebAPI],
});

const { elb, instance } = createSourceWalkerjs(config);
```

**After (Web Setup):**

```typescript
// Initialize collector with destinations
const instance = collector({
  destinations: [destinationGA4, destinationAPI],
});

// Add browser source for DOM tracking
const { elb } = sourceBrowser(instance, config);
```

**After (Server Setup):**

```typescript
// Initialize collector with server destinations
const instance = collector({
  destinations: [destinationFirehose, destinationMeta],
});

// Use collector directly for server events
instance.push(event);
```

**Key Function Changes:**

- **Single Collector**: Use `collector()` for both web and server
- **Source Composition**: Add sources like `sourceBrowser()` to the collector
  instance
- **ELB Layer**: Still available through sources (e.g., `sourceBrowser` returns
  `elb` for async commands)

### 4. Update Type References

**Before:**

```typescript
import type { createSourceWalkerjs } from '@elbwalker/walker.js';
import type { DestinationGoogleGA4 } from '@elbwalker/destination-web-google-ga4';
import type { WalkerOS, Elb } from '@elbwalker/types';

const config: SourceWalkerjs.InitConfig = {};
const event: WalkerOS.Event = {
  event: 'page view',
  data: {},
  // ...
};
```

**After:**

```typescript
import type { Collector, Source } from '@walkerOS/core';
import type { DestinationGA4 } from '@walkerOS/web-destination-ga4';
import type { WalkerOS, Elb } from '@walkerOS/core';

const config: Collector.InitConfig = {};
const sourceConfig: Source.Config = {};
const event: WalkerOS.Event = {
  event: 'page view',
  data: {},
  // ...
};
```

**Key Type Changes:**

- **Unified Types**: All core types now come from `@walkerOS/core`
- **Collector Types**: Use `Collector.*` namespace for collector-related types
- **Source Types**: Use `Source.*` namespace for source-related types
- **Platform-Specific**: Types like `Elb` (web) are still available from core

### 5. Server-Side Migration

**Before:**

```typescript
import { createSourceNode } from '@elbwalker/source-node';
import { destinationFirehose } from '@elbwalker/destination-node-aws';
import type { WalkerOS } from '@elbwalker/types';
import { isObject } from '@elbwalker/utils';

// Initialize server collector
const node = createSourceNode({
  destinations: [destinationFirehose],
});

// Send event
node.push(event);
```

**After:**

```typescript
import { collector } from '@walkerOS/collector';
import { destinationFirehose } from '@walkerOS/server-destination-aws';
import type { WalkerOS } from '@walkerOS/core';
import { isObject } from '@walkerOS/core';

// Initialize unified collector
const instance = collector({
  destinations: [destinationFirehose],
});

// Send event (same API)
instance.push(event);
```

**Key Server Changes:**

- **Unified Collector**: Same `collector()` function works for both web and
  server
- **No Platform Prefix**: Remove "node" or "server" prefixes from function names
- **Same API**: The `push()` method and event handling remain the same

### 6. Core Package Migration (Types & Utils)

This is the most significant change for developers who were directly using
`@elbwalker/types` and `@elbwalker/utils`. These packages have been merged into
`@walkerOS/core`.

#### Types Migration

**Before:**

```typescript
import type { WalkerOS, Elb, Destination, Mapping } from '@elbwalker/types';

// Custom destination implementation
const customDestination: Destination = {
  type: 'custom',
  init: (config) => {
    /* setup */
  },
  push: (event, config, mapping) => {
    /* handle event */
  },
};

// Event type annotation
const event: WalkerOS.Event = {
  event: 'purchase',
  data: { id: 'product-123' },
  // ...
};
```

**After:**

```typescript
import type { WalkerOS, Elb, Destination, Mapping } from '@walkerOS/core';

// Custom destination implementation
const customDestination: Destination = {
  type: 'custom',
  init: (config) => {
    /* setup */
  },
  push: (event, config, mapping) => {
    /* handle event */
  },
};

// Event type annotation
const event: WalkerOS.Event = {
  event: 'purchase',
  data: { id: 'product-123' },
  // ...
};
```

#### Utils Migration

**Before:**

```typescript
import {
  isObject,
  assign,
  getId,
  getByKey,
  SessionStorage,
  LocalStorage,
} from '@elbwalker/utils';

// Usage in custom destination
if (isObject(event.data)) {
  const mergedConfig = assign({}, defaultConfig, customConfig);
  const eventId = getId();
}
```

**After:**

```typescript
import {
  isObject,
  assign,
  getId,
  getByKey,
  SessionStorage,
  LocalStorage,
} from '@walkerOS/core';

// Usage in custom destination
if (isObject(event.data)) {
  const mergedConfig = assign({}, defaultConfig, customConfig);
  const eventId = getId();
}
```

#### Combined Usage

**Before:**

```typescript
import type { WalkerOS, Destination } from '@elbwalker/types';
import { isObject, assign } from '@elbwalker/utils';

// Custom destination with both types and utils
const myDestination: Destination = {
  type: 'my-destination',
  init: (config) => {
    return assign({}, defaultConfig, config);
  },
  push: (event: WalkerOS.Event, config, mapping) => {
    if (isObject(event.data)) {
      // Process event
    }
  },
};
```

**After:**

```typescript
import type { WalkerOS, Destination } from '@walkerOS/core';
import { isObject, assign } from '@walkerOS/core';

// Custom destination with both types and utils
const myDestination: Destination = {
  type: 'my-destination',
  init: (config) => {
    return assign({}, defaultConfig, config);
  },
  push: (event: WalkerOS.Event, config, mapping) => {
    if (isObject(event.data)) {
      // Process event
    }
  },
};
```

## Breaking Changes

### 1. Unified Collector Architecture

- **Old:** Separate `@elbwalker/walker.js` and `@elbwalker/source-node`
- **New:** Single `@walkerOS/collector` package for all platforms
- **Migration:** Use `collector()` function and add sources separately
- **Impact:** Cleaner separation between event processing and data collection

### 2. Modular Source System

- **Old:** DOM tracking built into `walker.js`
- **New:** Explicit `@walkerOS/web-source-browser` package
- **Migration:** Import and initialize sources separately
- **Impact:** Choose only the sources you need

### 3. Core Package Merger

- **Old:** Separate `@elbwalker/types` and `@elbwalker/utils` packages
- **New:** Unified `@walkerOS/core` package
- **Migration:** Update all imports to use `@walkerOS/core`
- **Impact:** All type imports and utility functions now come from a single
  package

### 4. Platform-Specific Cores

- **New:** `@walkerOS/web-core` and `@walkerOS/server-core` packages
- **Impact:** Platform-specific utilities are now separated from core logic
- **Migration:** Destinations depend on platform cores, not main collector

### 5. Package Structure Changes

- **Node packages:** `destination-node-*` → `server-destination-*`
- **Web packages:** `destination-web-*` → `web-destination-*`
- **Sources:** DOM tracking extracted to dedicated `web-source-browser`
- **Core packages:** `@elbwalker/types` + `@elbwalker/utils` → `@walkerOS/core`

### 6. Tagger Integration

- **Old:** Separate `@elbwalker/tagger` package
- **New:** Built into `@walkerOS/web-source-browser`
- **Migration:** Remove tagger dependency, automatically available with browser
  source

### 5. Destination API Context Changes

Destination function signatures have been simplified by consolidating parameters
into context objects. This change makes the API cleaner and more extensible.

**Key Changes:**

1. **Function Signature Simplification:**

   - `InitFn`: Parameters consolidated into a single `context` object
   - `PushFn`: Event parameter remains explicit, other parameters in `context`
   - `PushBatchFn`: Batch parameter remains explicit, other parameters in
     `context`

   **Before:**

   ```typescript
   type InitFn<Settings, Mapping> = (
     config?: PartialConfig<Settings, Mapping>,
     collector?: WalkerOS.Collector,
   ) => WalkerOS.PromiseOrValue<void | false | Config<Settings, Mapping>>;

   type PushFn<Settings, Mapping> = (
     event: WalkerOS.Event,
     config: Config<Settings, Mapping>,
     mapping?: WalkerOSMapping.Rule<Mapping>,
     options?: Options,
   ) => WalkerOS.PromiseOrValue<void>;
   ```

   **After:**

   ```typescript
   type InitFn<Settings, Mapping> = (
     context: InitContext<Settings, Mapping>,
   ) => WalkerOS.PromiseOrValue<void | false | Config<Settings, Mapping>>;

   type PushFn<Settings, Mapping> = (
     event: WalkerOS.Event,
     context: PushContext<Settings, Mapping>,
   ) => WalkerOS.PromiseOrValue<void>;
   ```

2. **Context Interfaces:**

   - `InitContext`: Contains `collector` and `config`
   - `PushContext`: Contains `collector`, `config`, `mapping`, and `data`
   - `PushBatchContext`: Contains `collector`, `config`, `mapping`, and `data`

3. **Options Interface Removed:**
   - The `Options` interface has been removed in favor of the context-based
     approach

**Migration Impact:**

```typescript
// Before
push(event, config, mapping, options) {
  const { collector, data } = options;
  // ...
}

// After
push(event, { collector, config, mapping, data }) {
  // Direct destructuring in parameter - no need for const assignment
  // ...
}
```

### 6. Mapping Terminology & Structure Updates

The event mapping system has undergone significant refactoring to improve
clarity, consistency, and alignment with the overall `walkerOS` naming
conventions.

**Key Changes:**

1.  **Renamed Core Mapping Types:**

    - `Mapping.Config` (the overall mapping rulebook) has been renamed to
      `Mapping.Rules`.
    - `Mapping.EventConfig` (a single event mapping rule) has been renamed to
      `Mapping.Rule`.
    - **Impact:** This clarifies the plural/singular relationship and better
      reflects their purpose as a collection of rules and individual rules.

    **Before:**

    ```typescript
    interface Config<CustomEvent = unknown> {
      /* ... */
    }
    interface EventConfig<CustomEvent = unknown> {
      /* ... */
    }
    ```

    **After:**

    ```typescript
    interface Rules<Settings = unknown> {
      /* ... */
    }
    interface Rule<Settings = unknown> {
      /* ... */
    }
    ```

2.  **Generic Parameter Renamed (`CustomEvent` to `Settings`):**

    - The generic type parameter used within `Mapping.Rules` and `Mapping.Rule`
      (previously `CustomEvent`) has been renamed to `Settings`.
    - **Impact:** This aligns with the `Destination<Settings, Mapping>` generic,
      making it clear that this generic is for destination-specific
      configuration settings within a mapping rule.

    **Before:**

    ```typescript
    interface Rule<CustomEvent = unknown> {
      custom?: CustomEvent; // ...
    }
    ```

    **After:**

    ```typescript
    interface Rule<Settings = unknown> {
      settings?: Settings; // ...
    }
    ```

3.  **`custom` Property Renamed to `settings` within `Mapping.Rule`:**

    - The `custom` property within a `Mapping.Rule` (which holds
      destination-specific configurations) has been renamed to `settings`.
    - **Impact:** This provides a more descriptive name for arbitrary
      configuration data specific to a particular mapping rule, maintaining
      consistency with `destination.config.settings`.

    **Before:**

    ```typescript
    // In Mapping.Rule
    custom?: CustomEvent;
    ```

    **After:**

    ```typescript
    // In Mapping.Rule
    settings?: Settings;
    ```

    - **Impact:** This resolves a potential name shadowing issue and clearly
      indicates that this alias represents a single, resolved mapping rule,
      distinguishing it from the `Mapping` namespace from `@walkerOS/core`.

## Validation Steps

1. **Update all package references** in package.json to new walkerOS packages
2. **Update all import statements** to use unified collector and modular sources
3. **Migrate to @walkerOS/core** for all type and utility imports
4. **Update function calls** to use `collector()` and separate source
   initialization
5. **Update type references** to use unified namespaces from core
6. **Test web functionality** with browser source and destinations
7. **Test server functionality** with collector and server destinations
8. **Verify source composition** works correctly (browser, dataLayer, etc.)

### Migration Checklist

#### Package Dependencies

- [ ] Remove old `@elbwalker/*` packages from dependencies
- [ ] Add `@walkerOS/collector` as main dependency
- [ ] Add required sources (e.g., `@walkerOS/web-source-browser`)
- [ ] Add required destinations (e.g., `@walkerOS/web-destination-ga4`)
- [ ] Add `@walkerOS/core` if building custom implementations

#### Code Updates

- [ ] Update all imports to use new package structure
- [ ] Replace old collector calls with unified `collector()` function
- [ ] Initialize sources separately (e.g., `sourceBrowser()`)
- [ ] Update all type imports to use `@walkerOS/core`
- [ ] Update all utility function imports to use `@walkerOS/core`
- [ ] Remove separate tagger initialization (now built into browser source)

#### Testing

- [ ] Verify TypeScript compilation with new imports
- [ ] Test event collection and destination delivery
- [ ] Test browser DOM tracking (if using web-source-browser)
- [ ] Test dataLayer integration (if using web-source-dataLayer)
- [ ] Test server event processing (if using server setup)
- [ ] Check that custom destinations still function properly

### Common Migration Issues

**Issue**: "Cannot find module @walkerOS/web-collector" **Solution**: The web
collector has been split - use `@walkerOS/collector` +
`@walkerOS/web-source-browser`

**Issue**: "elb is not defined" after migration **Solution**: The `elb` object
is returned by source initialization:
`const { elb } = sourceBrowser(instance, config)`

**Issue**: TypeScript cannot find types after migration **Solution**: Ensure
you're importing types from `@walkerOS/core` instead of the old packages

**Issue**: Tagger functions not available **Solution**: Tagger is now built into
`@walkerOS/web-source-browser` - no separate import needed

**Issue**: Destination not receiving events **Solution**: Verify you've added
the source to the collector instance (sources now need explicit initialization)

## Migration from Individual Packages

### From @walkerOS/web-destination-ga4

**Before:**

```typescript
import { destinationGA4 } from '@walkerOS/web-destination-ga4';

const destination = destinationGA4({
  settings: {
    measurementId: 'G-XXXXXXXXXX',
    debug: true,
  },
});
```

**After:**

```typescript
import { destinationGtag } from '@walkerOS/web-destination-gtag';

const destination = destinationGtag({
  settings: {
    ga4: {
      measurementId: 'G-XXXXXXXXXX',
      debug: true,
    },
  },
});
```

### From @walkerOS/web-destination-google_ads

**Before:**

```typescript
import { destinationAds } from '@walkerOS/web-destination-google_ads';

const destination = destinationAds({
  settings: {
    conversionId: 'AW-XXXXXXXXX',
    currency: 'USD',
  },
});
```

**After:**

```typescript
import { destinationGtag } from '@walkerOS/web-destination-gtag';

const destination = destinationGtag({
  settings: {
    ads: {
      conversionId: 'AW-XXXXXXXXX',
      currency: 'USD',
    },
  },
});
```

### From Multiple Packages

**Before:**

```typescript
import { destinationGA4 } from '@walkerOS/web-destination-ga4';
import { destinationAds } from '@walkerOS/web-destination-google_ads';
import { destinationGTM } from '@walkerOS/web-destination-gtm';

const destinations = [
  destinationGA4({ settings: { measurementId: 'G-XXXXXXXXXX' } }),
  destinationAds({ settings: { conversionId: 'AW-XXXXXXXXX' } }),
  destinationGTM({ settings: { containerId: 'GTM-XXXXXXX' } }),
];
```

**After:**

```typescript
import { destinationGtag } from '@walkerOS/web-destination-gtag';

const destinations = [
  destinationGtag({
    settings: {
      ga4: { measurementId: 'G-XXXXXXXXXX' },
      ads: { conversionId: 'AW-XXXXXXXXX' },
      gtm: { containerId: 'GTM-XXXXXXX' },
    },
  }),
];
```
