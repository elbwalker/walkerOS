---
title: Create Your Own Processor
description: Guide to building custom processors for walkerOS
sidebar_position: 99
---

# Create Your Own Processor

Build custom processors for validation, enrichment, or redaction.

## The Processor Interface

Processors are functions that receive a context object and return a processor instance:

<CodeSnippet
  code={`type Processor.Init<Types> = (
  context: Processor.Context<Types>,
) => Processor.Instance<Types>;`}
  language="typescript"
/>

The context contains:

<CodeSnippet
  code={`interface Processor.Context<Types> {
  config: Partial<Processor.Config<Types>>;  // Settings, mapping, next chain
  env: Types['env'];                          // Environment dependencies
  logger: Logger;                             // Logging functions
  id: string;                                 // Processor identifier
  collector: Collector.Instance;              // Collector reference
  ingest?: Ingest;                            // Request metadata from source
}`}
  language="typescript"
/>

The returned instance must implement:

<CodeSnippet
  code={`interface Processor.Instance {
  type: string;           // Unique identifier
  config: Processor.Config;
  push(event, context): event | false | void;
}`}
  language="typescript"
/>

## Return Values

| Return | Behavior |
|--------|----------|
| `event` | Continue chain with modified event |
| `void` | Continue chain, event unchanged |
| `false` | Stop chain, event dropped |

## Minimal Example

<CodeSnippet
  code={`import type { Processor } from '@walkeros/core';

interface Settings {
  removeFields?: string[];
}

interface Types extends Processor.Types<Settings> {}

export const processorRedact: Processor.Init<Types> = (context) => {
  // Destructure what you need from context
  const { config = {} } = context;
  const settings = config.settings || {};

  return {
    type: 'redact',
    config,

    push(event, pushContext) {
      const { logger } = pushContext;

      for (const field of settings.removeFields || []) {
        if (event.data?.[field]) {
          delete event.data[field];
          logger.debug('Redacted field', { field });
        }
      }

      return event;
    }
  };
};`}
  language="typescript"
/>

## Push Context

The `push` function receives an event and a push context:

* **`config`**: Processor configuration
* **`env`**: Environment dependencies
* **`logger`**: Scoped logger for output
* **`id`**: Processor identifier
* **`collector`**: Access to collector instance
* **`ingest`**: Request metadata from source (optional)

<CodeSnippet
  code={`push(event, context) {
  const { logger, id, ingest } = context;

  logger.debug('Processing event', { processor: id, event: event.name });

  // Access request metadata if available
  if (ingest?.ip) {
    event.data = { ...event.data, clientIp: ingest.ip };
  }

  return event;
}`}
  language="typescript"
/>

## Examples

### Enrich: Add Server-Side Data

<CodeSnippet
  code={`push(event, context) {
  event.data = {
    ...event.data,
    enrichedAt: Date.now(),
    region: 'eu-west-1',
  };

  return event;
}`}
  language="typescript"
/>

### Validate: Custom Check

<CodeSnippet
  code={`push(event, context) {
  if (!event.data?.id) {
    context.logger.error('Missing required id');
    return false;  // Stop chain
  }

  return event;
}`}
  language="typescript"
/>

## Using Your Processor

<CodeSnippet
  code={`import { startFlow } from '@walkeros/collector';
import { processorRedact } from './processorRedact';

await startFlow({
  processors: {
    redact: {
      code: processorRedact,
      config: {
        settings: {
          removeFields: ['email', 'phone']
        }
      }
    }
  }
});`}
  language="typescript"
/>

## Testing

<CodeSnippet
  code={`import { processorRedact } from '../index';
import type { Processor, Collector } from '@walkeros/core';
import { createMockLogger } from '@walkeros/core';

// Helper to create processor context for testing
function createProcessorContext(
  config: Partial<Processor.Config<Types>> = {},
): Processor.Context<Types> {
  return {
    config,
    env: {} as Types['env'],
    logger: createMockLogger(),
    id: 'test-redact',
    collector: {} as Collector.Instance,
  };
}

// Helper to create push context for testing
function createPushContext(): Processor.Context<Types> {
  return {
    config: {},
    env: {} as Types['env'],
    logger: createMockLogger(),
    id: 'test-redact',
    collector: {} as Collector.Instance,
  };
}

describe('Redact Processor', () => {
  it('removes specified fields', () => {
    const processor = processorRedact(
      createProcessorContext({
        settings: { removeFields: ['email'] }
      })
    );

    const event = { data: { id: '123', email: 'test@example.com' } };
    const pushContext = createPushContext();

    const result = processor.push(event, pushContext);

    expect(result.data.email).toBeUndefined();
    expect(result.data.id).toBe('123');
  });
});`}
  language="typescript"
/>

## Next Steps

* Review <Link to="/docs/processors/validator">Validator</Link> source as reference
* Learn about <Link to="/docs/sources/create-your-own">creating sources</Link>
* Learn about <Link to="/docs/destinations/create-your-own">creating destinations</Link>
