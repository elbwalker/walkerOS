---
title: DataLayer
description: Integration with existing dataLayer implementations
path: /docs/sources/web/dataLayer
sidebar_position: 2
package: '@walkeros/web-source-datalayer'
---
import { schemas } from '@walkeros/web-source-datalayer';

<PackageLink github="packages/web/sources/datalayer" npm="@walkeros/web-source-datalayer" />

# DataLayer Source

Integrates with existing Google Analytics 4 and GTM dataLayer implementations by intercepting `dataLayer.push()` calls.

## Installation

<CodeBox
  code={`npm install @walkeros/web-source-datalayer
`}
  disabled
  language="bash"
  label="Code Example"
  showHeader={false}
  autoHeight
/>

## Basic Setup

<CodeBox
  code={`import { startFlow } from '@walkeros/collector';
import { sourceDataLayer } from '@walkeros/web-source-datalayer';

const { collector, elb } = await startFlow({
  sources: {
    dataLayer: {
      code: sourceDataLayer,
      config: {
        settings: {
          name: 'dataLayer', // Name of global dataLayer array
          prefix: 'dataLayer', // Event prefix for filtering
        },
      },
    },
  },
  destinations: {
    // Your destinations
  },
});
`}
  disabled
  language="typescript"
  label="Code Example"
  showHeader={false}
  autoHeight
/>

## How It Works

The dataLayer source intercepts `dataLayer.push()` calls and transforms them into walkerOS events:

1. **Intercepts** existing `dataLayer.push()` calls
2. **Filters** events based on prefix or custom filter function
3. **Transforms** dataLayer format to walkerOS event format
4. **Forwards** to collector for processing

<CodeBox
  code={`// Existing dataLayer code (unchanged)
window.dataLayer = window.dataLayer || [];
dataLayer.push({ event: 'purchase', value: 99.99 });

// Automatically captured and transformed by sourceDataLayer
// â†’ Sent to walkerOS collector as standard event
`}
  disabled
  language="javascript"
  label="Code Example"
  showHeader={false}
  autoHeight
/>

## Configuration

<PropertyTable schema={schemas.settings} />

## Custom Filtering

Filter which dataLayer events get processed:

<CodeBox
  code={`const { elb } = await startFlow({
  sources: {
    dataLayer: {
      code: sourceDataLayer,
      config: {
        settings: {
          filter: (event) => {
            // Only process purchase and add_to_cart events
            if (typeof event === 'object' && event !== null) {
              const e = event as { event?: string };
              return e.event === 'purchase' || e.event === 'add_to_cart';
            }
            return false;
          },
        },
      },
    },
  },
});
`}
  disabled
  language="typescript"
  label="Code Example"
  showHeader={false}
  autoHeight
/>

## Migration Strategy

Use the dataLayer source for gradual migration from GA4/GTM:

### Phase 1: Add walkerOS alongside existing dataLayer

<CodeBox
  code={`// Existing code continues to work
dataLayer.push({ event: 'purchase', value: 99.99 });
// Now also captured by walkerOS`}
  disabled
  language="typescript"
  label="Code Example"
  showHeader={false}
  autoHeight
/>

### Phase 2: Map dataLayer events to walkerOS destinations

<CodeBox
  code={`destinations: {
  ga4: {
    code: destinationGtag,
    config: {
      mapping: {
        // Map dataLayer purchase to GA4 format
      }
    }
  }
}`}
  disabled
  language="typescript"
  label="Code Example"
  showHeader={false}
  autoHeight
/>

### Phase 3: Gradually replace dataLayer.push with elb()

<CodeBox
  code={`// Old
dataLayer.push({ event: 'purchase', value: 99.99 });
// New
elb('order complete', { total: 99.99 });`}
  disabled
  language="typescript"
  label="Code Example"
  showHeader={false}
  autoHeight
/>

## Next Steps

* Review [event mapping](/docs/mapping) for transforming dataLayer events
* Check [GA4 destination](/docs/destinations/web/gtag) for Google Analytics integration
