---
title: DataLayer
description: Integration with existing dataLayer implementations
path: /docs/sources/web/dataLayer
sidebar_position: 2
package: '@walkeros/web-source-datalayer'
---
import { schemas } from '@walkeros/web-source-datalayer/dev';

<PackageLink github="packages/web/sources/datalayer" npm="@walkeros/web-source-datalayer" />

# DataLayer Source

Integrates with existing Google Analytics 4 and GTM dataLayer implementations by intercepting `dataLayer.push()` calls.

:::info Where This Fits
The DataLayer Source is a **web source** in the walkerOS flow:

<FlowMap
  sources={{ default: { label: 'Source', text: 'dataLayer', highlight: true } }}
  collector={{ highlight: false }}
  destinations={{ default: { highlight: false } }}
/>

It bridges existing GA4/GTM implementations to walkerOS destinations.
:::

## Installation

<CodeSnippet
  code={`npm install @walkeros/web-source-datalayer`}
  language="bash"
/>

## Basic Setup

<Tabs groupId="mode">
  <TabItem value="integrated" label="Integrated" default>

<CodeSnippet
  code={`import { startFlow } from '@walkeros/collector';
import { sourceDataLayer } from '@walkeros/web-source-datalayer';

const { collector, elb } = await startFlow({
  sources: {
    dataLayer: {
      code: sourceDataLayer,
      config: {
        settings: {
          name: 'dataLayer', // Name of global dataLayer array
          prefix: 'dataLayer', // Event prefix for filtering
        },
      },
    },
  },
  destinations: {
    // Your destinations
  },
});`}
  language="typescript"
/>

  </TabItem>
  <TabItem value="bundled" label="Bundled">

Add to your `flow.json` sources:

<CodeSnippet
  code={`"sources": {
  "dataLayer": {
    "package": "@walkeros/web-source-datalayer",
    "config": {
      "settings": {
        "name": "dataLayer",
        "prefix": "dataLayer"
      }
    }
  }
}`}
  language="json"
/>

[See Bundled Mode setup →](/docs/getting-started/modes/bundled) | [CLI reference →](/docs/apps/cli)

  </TabItem>
</Tabs>

## How It Works

The dataLayer source intercepts `dataLayer.push()` calls and transforms them into walkerOS events:

1. **Intercepts** existing `dataLayer.push()` calls
2. **Filters** events based on prefix or custom filter function
3. **Transforms** dataLayer format to walkerOS event format
4. **Forwards** to collector for processing

<CodeSnippet
  code={`// Existing dataLayer code (unchanged)
window.dataLayer = window.dataLayer || [];
dataLayer.push({ event: 'purchase', value: 99.99 });

// Automatically captured and transformed by sourceDataLayer
// → Sent to walkerOS collector as standard event`}
  language="javascript"
/>

## Configuration

<PropertyTable schema={schemas.settings} />

## Custom Filtering

Filter which dataLayer events get processed:

<CodeSnippet
  code={`const { elb } = await startFlow({
  sources: {
    dataLayer: {
      code: sourceDataLayer,
      config: {
        settings: {
          filter: (event) => {
            // Only process purchase and add_to_cart events
            if (typeof event === 'object' && event !== null) {
              const e = event as { event?: string };
              return e.event === 'purchase' || e.event === 'add_to_cart';
            }
            return false;
          },
        },
      },
    },
  },
});`}
  language="typescript"
/>

## Migration Strategy

Use the dataLayer source for gradual migration from GA4/GTM:

### Phase 1: Add walkerOS alongside existing dataLayer

<CodeSnippet
  code={`// Existing code continues to work
dataLayer.push({ event: 'purchase', value: 99.99 });
// Now also captured by walkerOS`}
  language="typescript"
/>

### Phase 2: Map dataLayer events to walkerOS destinations

<CodeSnippet
  code={`destinations: {
  ga4: {
    code: destinationGtag,
    config: {
      mapping: {
        // Map dataLayer purchase to GA4 format
      }
    }
  }
}`}
  language="typescript"
/>

### Phase 3: Gradually replace dataLayer.push with elb()

<CodeSnippet
  code={`// Old
dataLayer.push({ event: 'purchase', value: 99.99 });
// New
elb('order complete', { total: 99.99 });`}
  language="typescript"
/>

## Next Steps

* Review [event mapping](/docs/mapping) for transforming dataLayer events
* Check [GA4 destination](/docs/destinations/web/gtag) for Google Analytics integration
