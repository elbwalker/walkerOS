---
title: Create Your Own Transformer
description: Guide to building custom transformers for walkerOS
sidebar_position: 99
---

# Create Your Own Transformer

Build custom transformers for validation, enrichment, or redaction.

## The transformer interface

Transformers are functions that receive a context object and return a transformer instance:

<CodeSnippet
  code={`type Transformer.Init<Types> = (
  context: Transformer.Context<Types>,
) => Transformer.Instance<Types>;`}
  language="typescript"
/>

The context contains:

<CodeSnippet
  code={`interface Transformer.Context<Types> {
  config: Partial<Transformer.Config<Types>>;  // Settings, mapping, next chain
  env: Types['env'];                          // Environment dependencies
  logger: Logger;                             // Logging functions
  id: string;                                 // Transformer identifier
  collector: Collector.Instance;              // Collector reference
  ingest?: Ingest;                            // Request metadata from source
}`}
  language="typescript"
/>

The returned instance must implement:

<CodeSnippet
  code={`interface Transformer.Instance {
  type: string;           // Unique identifier
  config: Transformer.Config;
  push(event, context): event | false | void;
}`}
  language="typescript"
/>

## Return values

| Return | Behavior |
|--------|----------|
| `event` | Continue chain with modified event |
| `void` | Continue chain, event unchanged |
| `false` | Stop chain, event dropped |

## Minimal example

<CodeSnippet
  code={`import type { Transformer } from '@walkeros/core';

interface Settings {
  removeFields?: string[];
}

interface Types extends Transformer.Types<Settings> {}

export const transformerRedact: Transformer.Init<Types> = (context) => {
  // Destructure what you need from context
  const { config = {} } = context;
  const settings = config.settings || {};

  return {
    type: 'redact',
    config,

    push(event, pushContext) {
      const { logger } = pushContext;

      for (const field of settings.removeFields || []) {
        if (event.data?.[field]) {
          delete event.data[field];
          logger.debug('Redacted field', { field });
        }
      }

      return event;
    }
  };
};`}
  language="typescript"
/>

## Push context

The `push` function receives an event and a push context:

* **`config`**: Transformer configuration
* **`env`**: Environment dependencies
* **`logger`**: Scoped logger for output
* **`id`**: Transformer identifier
* **`collector`**: Access to collector instance
* **`ingest`**: Request metadata from source (optional)

<CodeSnippet
  code={`push(event, context) {
  const { logger, id, ingest } = context;

  logger.debug('Processing event', { transformer: id, event: event.name });

  // Access request metadata if available
  if (ingest?.ip) {
    event.data = { ...event.data, clientIp: ingest.ip };
  }

  return event;
}`}
  language="typescript"
/>

## Examples

### Enrich: add server-side data

<CodeSnippet
  code={`push(event, context) {
  event.data = {
    ...event.data,
    enrichedAt: Date.now(),
    region: 'eu-west-1',
  };

  return event;
}`}
  language="typescript"
/>

### Validate: custom check

<CodeSnippet
  code={`push(event, context) {
  if (!event.data?.id) {
    context.logger.error('Missing required id');
    return false;  // Stop chain
  }

  return event;
}`}
  language="typescript"
/>

## Using your transformer

<CodeSnippet
  code={`import { startFlow } from '@walkeros/collector';
import { transformerRedact } from './transformerRedact';

await startFlow({
  transformers: {
    redact: {
      code: transformerRedact,
      config: {
        settings: {
          removeFields: ['email', 'phone']
        }
      }
    }
  }
});`}
  language="typescript"
/>

## Testing

<CodeSnippet
  code={`import { transformerRedact } from '../index';
import type { Transformer, Collector } from '@walkeros/core';
import { createMockLogger } from '@walkeros/core';

// Helper to create transformer context for testing
function createTransformerContext(
  config: Partial<Transformer.Config<Types>> = {},
): Transformer.Context<Types> {
  return {
    config,
    env: {} as Types['env'],
    logger: createMockLogger(),
    id: 'test-redact',
    collector: {} as Collector.Instance,
  };
}

// Helper to create push context for testing
function createPushContext(): Transformer.Context<Types> {
  return {
    config: {},
    env: {} as Types['env'],
    logger: createMockLogger(),
    id: 'test-redact',
    collector: {} as Collector.Instance,
  };
}

describe('Redact Transformer', () => {
  it('removes specified fields', () => {
    const transformer = transformerRedact(
      createTransformerContext({
        settings: { removeFields: ['email'] }
      })
    );

    const event = { data: { id: '123', email: 'test@example.com' } };
    const pushContext = createPushContext();

    const result = transformer.push(event, pushContext);

    expect(result.data.email).toBeUndefined();
    expect(result.data.id).toBe('123');
  });
});`}
  language="typescript"
/>

## Next steps

* Review <Link to="/docs/transformers/validator">Validator</Link> source as reference
* Learn about <Link to="/docs/sources/create-your-own">creating sources</Link>
* Learn about <Link to="/docs/destinations/create-your-own">creating destinations</Link>
